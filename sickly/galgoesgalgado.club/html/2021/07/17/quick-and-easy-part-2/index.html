<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>quick_and_easy-part-2</title><link rel="stylesheet" href="/css/normalize.css"><link rel="stylesheet" href="/css/heti.min.css"><link rel="stylesheet" href="/css/hexo-theme-adoubi.css"><link rel="icon" href="/images/favicon.ico"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="" type="application/atom+xml">
</head><body><div class="header"><a class="github-link" target="_blank" rel="noopener" href="https://notabug.org/micaldas"><img class="github-image" src="/images/Aquicon-Github-small.png"></a><a class="email-link" href="mailto:mclds@protonmail.com"><img class="email-image" src="/images/email-small.png"></a><a class="subscribe-link" href="/atom.xml"><img class="subscribe-image" src="/images/subscribe-small.png"></a></div><div class="content"><div class="post-item"></div><h2 class="post-title-wrapper"><p class="post-title">quick_and_easy-part-2</p></h2><div class="post-date"><time datetime="2021-07-17T11:38:28.000Z">2021-07-17</time></div><div class="post-content"><p>After the last post, the notes web-app has developed considerably and I would like to document the changes I needed to do.<br>Due to the large number of notes, everything in this project has to be automated, to be, in the least, time-efficient.<br>That has presented me with a lot of opportunities to deepen my Python knowledge, in order to achieve said automation. At times it has been so vexing and frustrating, that I looked for solutions in shell scripting. Something I know very little about, but where I was fairly certain the solutions to my problems were already found.<br>In the end it was more instructional than a great furtherance of my objectives. Most of the found solutions were found with Python, with one or two exceptions, I think.<br>That said, I would like very much to know more about shell scripting because, although the syntax is eye-watering, there is a lot of work already done there. The solutions are present and real. You just have to enjoy the fruits of past work.<br>Another problem was the inevitable need to interact with code structures like <a target="_blank" rel="noopener" href="https://sass-lang.com/">SASS</a> and <a target="_blank" rel="noopener" href="https://pugjs.org/api/getting-started.html">Pug</a>. Which, even if very enticing, especially Pug, implied that I had to learn a new framework.<br>I’m using a lot of pre-built, free-to-use, CSS snippets, made accessible by kind hearted designers, and if that gives me access to better ideas and execution, it makes me also contact with more sophisticated tools.<br>In the end, I minimized complexity to the maximum. From SASS I used it exclusively to convert SCSS files, as they were made available, to traditional CSS, which, for now, is what browsers accept.<br>I used Pug also to convert a file written in its markup style. But Pug presented a very interesting concept in HTML writing rationalization and simplification. I hope to get back to this, with more time and in more depth.<br>For all the work that it created, the Notes Manager app is surprisingly, still, bare-boned. At this moment I’m still ironing out the kinks in site search, and haven’t introduced any other functionality.<br>This is also because search made me deviate from what I wanted to do in the beginning, <em>vis a vis</em> databases. I didn’t understood that there was absolutely no reason to presume a simpler, lighter data structure for the web version. This made me look into content tags, search and db structure. And hence the slowness.<br>Add to this the fact that you have to standardize and make alterations in around 140 pages, and the time investment doesn’t seem that huge.<br>Coming, finally, to the files I created for this project; let’s start with ‘auto.py’, that intends to automate content page creation.<br>If you remember, I had exported all note entries in the database to individual text files, to later turn into php or html.<br>This, I noticed suitably later, was a mistake.<br>I could just as well converted them to php files immediately, which is what I’m using right now, and I would have saved a lot of cumbersome steps.<br>I’m using PHP because of its ability to be injected into files, really helps when creating large volume content files. I have seen myself veer away from HTML and head, more and more, to PHP country.<br>Some of these design decisions have to do with project structure I created for database oriented, web apps. I intend to do a small post just in that very same subject. Not to get very deeply into this here, I wanted to separate the html part that is viewable to the user, and a php file that would address backend needs.<br>I created the pages that would receive php code through a ‘require’ tag. In the end I would have the specific individual note content in a folder, and in another, the display html pages where they will be seen.<br>This is how it was structured:</p>
<hr>
<h2><span id="1-autopy">1 - auto.py</span></h2><ol>
<li>Imported <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/shutil.html">shutil</a>, to copy files around.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> shutil</span><br></pre></td></tr></table></figure></li>
<li>created a function and determined what and where would be the template file.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">auto</span>():</span></span><br><span class="line">    source = <span class="string">&#x27;/srv/http/notes/pages/styled_notes/index.php&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li>In the beginning, boneheadedly, I thought I would make do only with integer id’s and URLs to identify the content. To do that, I completed a list of all the note id’s I had uploaded to the site. And that was my base.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;number_list.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
<li>I stripped them of newline symbols and organized them in their own rows, and closed the connection to the file.    <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">numbers = [(line.strip()).split() <span class="keyword">for</span> line <span class="keyword">in</span> f]</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure></li>
<li>These id numbers were being outputted by MySQL like this: “‘[6]’”. It was necessary to strip everything that wasn’t the string character from the output.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> number <span class="keyword">in</span> numbers:</span><br><span class="line">        numero = <span class="built_in">str</span>(number)</span><br><span class="line">        numero = numero[<span class="number">2</span>:-<span class="number">2</span>]</span><br></pre></td></tr></table></figure></li>
<li>Defined the URL of the display files to be created.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">destination = <span class="string">&#x27;/srv/http/notes/pages/styled_notes/&#x27;</span> + numero + <span class="string">&#x27;-page.php&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li>Copied the file.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shutil.copyfile(source, destination)</span><br></pre></td></tr></table></figure></li>
<li>Opened the display pages to read,  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(destination, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.readlines()</span><br></pre></td></tr></table></figure></li>
<li>On line 19 of the file, I inserted a php tag with the note content and its title.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data[<span class="number">19</span>] = <span class="string">&quot;&lt;?php require &#x27;http://localhost/notes/pages/text1/&quot;</span> + numero + <span class="string">&quot;.php&#x27;; ?&gt;&quot;</span></span><br></pre></td></tr></table></figure></li>
<li>and wrote to it.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(destination, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.writelines(data)</span><br></pre></td></tr></table></figure></li>
</ol>
<p>Full code document:  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">auto</span>():</span></span><br><span class="line">    source = <span class="string">&#x27;/srv/http/notes/pages/styled_notes/index.php&#x27;</span></span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&#x27;number_list.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">    numbers = [(line.strip()).split() <span class="keyword">for</span> line <span class="keyword">in</span> f]</span><br><span class="line">    f.close()</span><br><span class="line">    <span class="keyword">for</span> number <span class="keyword">in</span> numbers:</span><br><span class="line">        numero = <span class="built_in">str</span>(number)</span><br><span class="line">        numero = numero[<span class="number">2</span>:-<span class="number">2</span>]</span><br><span class="line">        destination = <span class="string">&#x27;/srv/http/notes/pages/styled_notes/&#x27;</span> + numero + <span class="string">&#x27;-page.php&#x27;</span></span><br><span class="line">        shutil.copyfile(source, destination)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(destination, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            data = f.readlines()</span><br><span class="line">        data[<span class="number">19</span>] = <span class="string">&quot;&lt;?php require &#x27;http://localhost/notes/pages/text1/&quot;</span> + numero + <span class="string">&quot;.php&#x27;; ?&gt;&quot;</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(destination, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.writelines(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    auto()</span><br></pre></td></tr></table></figure>
<hr>
<h2><span id="2-htmlpy">2 - html.py</span></h2><p>This is a file that has precedence in the process in relation to the last file.<br>It’s a script to convert text to html. As I said, a step I didn’t need to take.<br>When I said that had looked, and found, shell solutions to my problems, but kept most of the code as Python; this is what I’m talking about: Subprocess.  </p>
<ol>
<li>Import os and subprocess:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br></pre></td></tr></table></figure></li>
<li>Created a python function and used txt2html to convert the files:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert</span>(<span class="params">filepath</span>):</span></span><br><span class="line">    cmd = <span class="string">&#x27;txt2html --infile &#x27;</span> + filepath + <span class="string">&#x27; --outfile &#x27;</span> + filepath + <span class="string">&#x27;.html&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li>called the function through subprocess, as txt2html its not a Python app.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">subprocess.run(cmd, shell=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></li>
<li>Defined where the text files were, and iterated through them, creating html files.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dir</span> = <span class="string">&#x27;/srv/http/notes/clean&#x27;</span></span><br><span class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(<span class="built_in">dir</span>):</span><br><span class="line">    filepath = os.path.join(<span class="built_in">dir</span>, filename)</span><br><span class="line">    convert(filepath)</span><br></pre></td></tr></table></figure></li>
</ol>
<p>Whole code document:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot; Script to convert text files in html. &quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert</span>(<span class="params">filepath</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; First it is defined how to replace the characters and after how to access the files &quot;&quot;&quot;</span></span><br><span class="line">    cmd = <span class="string">&#x27;txt2html --infile &#x27;</span> + filepath + <span class="string">&#x27; --outfile &#x27;</span> + filepath + <span class="string">&#x27;.html&#x27;</span></span><br><span class="line">    subprocess.run(cmd, shell=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">dir</span> = <span class="string">&#x27;/srv/http/notes/clean&#x27;</span></span><br><span class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(<span class="built_in">dir</span>):</span><br><span class="line">    filepath = os.path.join(<span class="built_in">dir</span>, filename)</span><br><span class="line">    convert(filepath)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    convert(filepath)</span><br></pre></td></tr></table></figure>
<hr>
<h2><span id="3-db_uploadpy">3 - db_upload.py</span></h2><p>For some reason I can not remember at this moment, it wasn’t easy to translate the cli notes to web form. I had to go back and forth between the db and the site to get all the data.<br>This is, summarily, all the work that was done in the next files presented here.<br>In this file we uploaded the tags content to the site, in bunches of three tags per note and their respective ids.  </p>
<ol>
<li>Imported mysql to connect to the database and itertools for grouping the entries.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mysql.connector <span class="keyword">import</span> connect, Error</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> zip_longest</span><br></pre></td></tr></table></figure></li>
<li>As per last time, I opened a file with the entries and cleaned them a bit:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;tagsaa.csv&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    lines = f.read().splitlines()</span><br></pre></td></tr></table></figure></li>
<li>Turn them into a python list:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string_list = [<span class="string">&#x27;8,backblaze,duplicity,backup&#x27;</span>, <span class="string">&#x27;10,flake8,error,ignore&#x27;</span>, <span class="string">&#x27;12,cc,card,credit&#x27;</span>, <span class="string">&#x27;14,backblaze,keys,backups&#x27;</span>, <span class="string">&#x27;15,umount,mount,unmounting&#x27;</span>, <span class="string">&#x27;16,numpy,array,append&#x27;</span>, <span class="string">&#x27;26,openssl,ssl,mail&#x27;</span>, <span class="string">&#x27;28,bind,keys,bindkeys&#x27;</span>, <span class="string">&#x27;30,editor,command line,editing&#x27;</span>, <span class="string">&#x27;32,markdown,line break,notabug&#x27;</span>, <span class="string">&#x27;34,python,delete,file&#x27;</span>, <span class="string">&#x27;38,table,tables,sqlite&#x27;</span>, <span class="string">&#x27;41,dictionary,python,key&#x27;</span>, <span class="string">&#x27;49,rowid,id,sqlite&#x27;</span>, <span class="string">&#x27;51,fulltext,sqlite utils,full text&#x27;</span>, <span class="string">&#x27;55,sqlite-utils,triggers,trigger&#x27;</span>, <span class="string">&#x27;63,strings,string,python&#x27;</span>, <span class="string">&#x27;66,string,skip,strings&#x27;</span>, <span class="string">&#x27;67,dictionary,item,dictionaries&#x27;</span>, <span class="string">&#x27;68,list,skip,remove&#x27;</span>, <span class="string">&#x27;74,cmus,player,music&#x27;</span>, <span class="string">&#x27;78,goaccess,logs,analytics&#x27;</span>, <span class="string">&#x27;86,mysql,columns,generated&#x27;</span>, <span class="string">&#x27;88,mysql,last row,rows&#x27;</span>, <span class="string">&#x27;91,mysql,backup,dump&#x27;</span>, <span class="string">&#x27;92,epub,web,self-hosted&#x27;</span>, <span class="string">&#x27;95,xdg-open,default,xdg&#x27;</span>, <span class="string">&#x27;99,ufw,port,range&#x27;</span>, <span class="string">&#x27;102,zsh-autosuggestions,zsh,oh-my-zsh&#x27;</span>, <span class="string">&#x27;103,sudo,password,script&#x27;</span>, <span class="string">&#x27;108,pip,pip3,python&#x27;</span>, <span class="string">&#x27;110,white house,market,white&#x27;</span>, <span class="string">&#x27;116,vim,clipboard,ssh&#x27;</span>, <span class="string">&#x27;125,user.,group,ps&#x27;</span>, <span class="string">&#x27;129,arch,source,aur&#x27;</span>, <span class="string">&#x27;130,indentation,python,unindent&#x27;</span>, <span class="string">&#x27;133,vim,commentar,comment&#x27;</span>, <span class="string">&#x27;134,php code sniffer,php,linter&#x27;</span>, <span class="string">&#x27;136,css,name,selector&#x27;</span>, <span class="string">&#x27;&#x27;</span>]</span><br></pre></td></tr></table></figure></li>
<li>Cleaned again the content,<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">newlist = [i <span class="keyword">for</span> item <span class="keyword">in</span> string_list <span class="keyword">for</span> i <span class="keyword">in</span> item.split(<span class="string">&#x27;,&#x27;</span>)]</span><br><span class="line"><span class="built_in">print</span>(newlist)</span><br></pre></td></tr></table></figure></li>
<li>Used the grouper function to chunk the entries together.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">grouper</span>(<span class="params">iterable_obj, count, fillvalue=<span class="literal">None</span></span>):</span></span><br><span class="line">    args = [<span class="built_in">iter</span>(iterable_obj)] * count</span><br><span class="line">    <span class="keyword">return</span> zip_longest(*args, fillvalue=fillvalue)</span><br><span class="line">iterable = newlist</span><br></pre></td></tr></table></figure></li>
<li>Created a function to insert the grouper content into the site.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insert</span>():</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        conn = connect(</span><br><span class="line">                host=<span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">                user=<span class="string">&quot;mic&quot;</span>,</span><br><span class="line">                password=<span class="string">&quot;xxxx&quot;</span>,</span><br><span class="line">                database=<span class="string">&quot;notes_web&quot;</span>)</span><br><span class="line">        cur = conn.cursor()</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> grouper(iterable, <span class="number">4</span>, <span class="string">&#x27;&#x27;</span>):</span><br><span class="line">            query = <span class="string">&#x27;UPDATE notes_web SET k1 = &quot;&#x27;</span> + x[<span class="number">1</span>] + <span class="string">&#x27;&quot;, k2 = &quot;&#x27;</span> + x[<span class="number">2</span>] + <span class="string">&#x27;&quot;, k3 = &quot;&#x27;</span> + x[<span class="number">3</span>] + <span class="string">&#x27;&quot; WHERE id = &quot;&#x27;</span> + x[<span class="number">0</span>] + <span class="string">&#x27;&quot;&#x27;</span></span><br><span class="line">            <span class="built_in">print</span>(query)</span><br><span class="line">            cur.execute(query)</span><br><span class="line">            conn.commit()</span><br><span class="line">    <span class="keyword">except</span> Error <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Error while connecting to db&quot;</span>, e)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">if</span>(conn):</span><br><span class="line">            conn.close()</span><br></pre></td></tr></table></figure></li>
</ol>
<p>The whole content:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mysql.connector <span class="keyword">import</span> connect, Error</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> zip_longest</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;tagsaa.csv&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    lines = f.read().splitlines()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">string_list = [<span class="string">&#x27;8,backblaze,duplicity,backup&#x27;</span>, <span class="string">&#x27;10,flake8,error,ignore&#x27;</span>, <span class="string">&#x27;12,cc,card,credit&#x27;</span>, <span class="string">&#x27;14,backblaze,keys,backups&#x27;</span>, <span class="string">&#x27;15,umount,mount,unmounting&#x27;</span>, <span class="string">&#x27;16,numpy,array,append&#x27;</span>, <span class="string">&#x27;26,openssl,ssl,mail&#x27;</span>, <span class="string">&#x27;28,bind,keys,bindkeys&#x27;</span>, <span class="string">&#x27;30,editor,command line,editing&#x27;</span>, <span class="string">&#x27;32,markdown,line break,notabug&#x27;</span>, <span class="string">&#x27;34,python,delete,file&#x27;</span>, <span class="string">&#x27;38,table,tables,sqlite&#x27;</span>, <span class="string">&#x27;41,dictionary,python,key&#x27;</span>, <span class="string">&#x27;49,rowid,id,sqlite&#x27;</span>, <span class="string">&#x27;51,fulltext,sqlite utils,full text&#x27;</span>, <span class="string">&#x27;55,sqlite-utils,triggers,trigger&#x27;</span>, <span class="string">&#x27;63,strings,string,python&#x27;</span>, <span class="string">&#x27;66,string,skip,strings&#x27;</span>, <span class="string">&#x27;67,dictionary,item,dictionaries&#x27;</span>, <span class="string">&#x27;68,list,skip,remove&#x27;</span>, <span class="string">&#x27;74,cmus,player,music&#x27;</span>, <span class="string">&#x27;78,goaccess,logs,analytics&#x27;</span>, <span class="string">&#x27;86,mysql,columns,generated&#x27;</span>, <span class="string">&#x27;88,mysql,last row,rows&#x27;</span>, <span class="string">&#x27;91,mysql,backup,dump&#x27;</span>, <span class="string">&#x27;92,epub,web,self-hosted&#x27;</span>, <span class="string">&#x27;95,xdg-open,default,xdg&#x27;</span>, <span class="string">&#x27;99,ufw,port,range&#x27;</span>, <span class="string">&#x27;102,zsh-autosuggestions,zsh,oh-my-zsh&#x27;</span>, <span class="string">&#x27;103,sudo,password,script&#x27;</span>, <span class="string">&#x27;108,pip,pip3,python&#x27;</span>, <span class="string">&#x27;110,white house,market,white&#x27;</span>, <span class="string">&#x27;116,vim,clipboard,ssh&#x27;</span>, <span class="string">&#x27;125,user.,group,ps&#x27;</span>, <span class="string">&#x27;129,arch,source,aur&#x27;</span>, <span class="string">&#x27;130,indentation,python,unindent&#x27;</span>, <span class="string">&#x27;133,vim,commentar,comment&#x27;</span>, <span class="string">&#x27;134,php code sniffer,php,linter&#x27;</span>, <span class="string">&#x27;136,css,name,selector&#x27;</span>, <span class="string">&#x27;&#x27;</span>]</span><br><span class="line"></span><br><span class="line">newlist = [i <span class="keyword">for</span> item <span class="keyword">in</span> string_list <span class="keyword">for</span> i <span class="keyword">in</span> item.split(<span class="string">&#x27;,&#x27;</span>)]</span><br><span class="line"><span class="built_in">print</span>(newlist)</span><br><span class="line"></span><br><span class="line"><span class="comment"># https://tinyurl.com/yk472wo3</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">grouper</span>(<span class="params">iterable_obj, count, fillvalue=<span class="literal">None</span></span>):</span></span><br><span class="line">    args = [<span class="built_in">iter</span>(iterable_obj)] * count</span><br><span class="line">    <span class="keyword">return</span> zip_longest(*args, fillvalue=fillvalue)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">iterable = newlist</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insert</span>():</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        conn = connect(</span><br><span class="line">                host=<span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">                user=<span class="string">&quot;mic&quot;</span>,</span><br><span class="line">                password=<span class="string">&quot;xxxx&quot;</span>,</span><br><span class="line">                database=<span class="string">&quot;notes_web&quot;</span>)</span><br><span class="line">        cur = conn.cursor()</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> grouper(iterable, <span class="number">4</span>, <span class="string">&#x27;&#x27;</span>):</span><br><span class="line">            query = <span class="string">&#x27;UPDATE notes_web SET k1 = &quot;&#x27;</span> + x[<span class="number">1</span>] + <span class="string">&#x27;&quot;, k2 = &quot;&#x27;</span> + x[<span class="number">2</span>] + <span class="string">&#x27;&quot;, k3 = &quot;&#x27;</span> + x[<span class="number">3</span>] + <span class="string">&#x27;&quot; WHERE id = &quot;&#x27;</span> + x[<span class="number">0</span>] + <span class="string">&#x27;&quot;&#x27;</span></span><br><span class="line">            <span class="built_in">print</span>(query)</span><br><span class="line">            cur.execute(query)</span><br><span class="line">            conn.commit()</span><br><span class="line">    <span class="keyword">except</span> Error <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Error while connecting to db&quot;</span>, e)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">if</span>(conn):</span><br><span class="line">            conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    insert()</span><br></pre></td></tr></table></figure>
<hr>
<h2><span id="4-titlespy">4 - titles.py</span></h2><p>At some moment in the process, I, finally, understood that the notes titles were a necessity, and I had to import them to this project. This is what I did in this module.  </p>
<ol>
<li>Import MySQL connection to Python.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mysql.connector <span class="keyword">import</span> connect, Error</span><br></pre></td></tr></table></figure></li>
<li>To compartmentalize and avoid heartbreak, I decided that the cli version and the web version would have their own separate databases, and that was one of my best design decisions to date. I took the entries in the ‘title’ column of the cli app, put them in a list and closed this connection.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = connect(</span><br><span class="line">        host=<span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">        user=<span class="string">&quot;mic&quot;</span>,</span><br><span class="line">        password=<span class="string">&quot;xxxx&quot;</span>,</span><br><span class="line">        database=<span class="string">&quot;notes&quot;</span>)</span><br><span class="line">    cur = conn.cursor()</span><br><span class="line">    tit_list = []</span><br><span class="line">    title_list = <span class="string">&quot;&quot;&quot; SELECT ntid, title from notes &quot;&quot;&quot;</span></span><br><span class="line">    cur.execute(title_list)</span><br><span class="line">    records = cur.fetchall()</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> records:</span><br><span class="line">        tit_list.append(row)</span><br><span class="line"><span class="keyword">except</span> Error <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Error while connecting to db&quot;</span>, e)</span><br></pre></td></tr></table></figure></li>
<li>After that, I started another MySQL connection, now to my web database, to update it with the new/old content.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = connect(</span><br><span class="line">        host=<span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">        user=<span class="string">&quot;mic&quot;</span>,</span><br><span class="line">        password=<span class="string">&quot;xxxx&quot;</span>,</span><br><span class="line">        database=<span class="string">&quot;notes_web&quot;</span>)</span><br><span class="line">    cur = conn.cursor()</span><br><span class="line">    <span class="built_in">print</span>(tit_list)</span><br><span class="line">    <span class="keyword">for</span> tit <span class="keyword">in</span> tit_list:</span><br><span class="line">        answer = [<span class="built_in">str</span>(tit[<span class="number">1</span>]), <span class="built_in">int</span>(tit[<span class="number">0</span>])]</span><br><span class="line">        <span class="built_in">print</span>(answer)</span><br><span class="line">        query = <span class="string">&quot;&quot;&quot; UPDATE notes_web SET title = %s WHERE id = %s&quot;&quot;&quot;</span></span><br><span class="line">        cur.execute(query, answer)</span><br><span class="line">        <span class="built_in">print</span>(query)</span><br><span class="line">        conn.commit()</span><br></pre></td></tr></table></figure></li>
</ol>
<p>Complete file:  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mysql.connector <span class="keyword">import</span> connect, Error</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">titles</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        conn = connect(</span><br><span class="line">            host=<span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">            user=<span class="string">&quot;mic&quot;</span>,</span><br><span class="line">            password=<span class="string">&quot;xxxx&quot;</span>,</span><br><span class="line">            database=<span class="string">&quot;notes&quot;</span>)</span><br><span class="line">        cur = conn.cursor()</span><br><span class="line">        tit_list = []</span><br><span class="line">        title_list = <span class="string">&quot;&quot;&quot; SELECT ntid, title from notes &quot;&quot;&quot;</span></span><br><span class="line">        cur.execute(title_list)</span><br><span class="line">        records = cur.fetchall()</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> records:</span><br><span class="line">            tit_list.append(row)</span><br><span class="line">    <span class="keyword">except</span> Error <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Error while connecting to db&quot;</span>, e)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        conn = connect(</span><br><span class="line">            host=<span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">            user=<span class="string">&quot;mic&quot;</span>,</span><br><span class="line">            password=<span class="string">&quot;xxxx&quot;</span>,</span><br><span class="line">            database=<span class="string">&quot;notes_web&quot;</span>)</span><br><span class="line">        cur = conn.cursor()</span><br><span class="line">        <span class="built_in">print</span>(tit_list)</span><br><span class="line">        <span class="keyword">for</span> tit <span class="keyword">in</span> tit_list:</span><br><span class="line">            answer = [<span class="built_in">str</span>(tit[<span class="number">1</span>]), <span class="built_in">int</span>(tit[<span class="number">0</span>])]</span><br><span class="line">            <span class="built_in">print</span>(answer)</span><br><span class="line">            query = <span class="string">&quot;&quot;&quot; UPDATE notes_web SET title = %s WHERE id = %s&quot;&quot;&quot;</span></span><br><span class="line">            cur.execute(query, answer)</span><br><span class="line">            <span class="built_in">print</span>(query)</span><br><span class="line">            conn.commit()</span><br><span class="line">    <span class="keyword">except</span> Error <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Error while connecting to db&quot;</span>, e)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">if</span>(conn):</span><br><span class="line">            conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    titles()</span><br></pre></td></tr></table></figure>
<hr>
<h2><span id="5-urlspy">5 - urls.py</span></h2><p>This files creates and uploads to the database the notes URLs in the site.  </p>
<ol>
<li>I take the display pages already created, extract the URLs and the id’s from their links into two parallel lists, that I posteriorly join into a dictionary, through zip.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">path = <span class="string">&#x27;/srv/http/notes/pages/styled_notes&#x27;</span></span><br><span class="line">files = os.listdir(path)</span><br><span class="line">linques = []</span><br><span class="line">ids = []</span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">    linques.append(<span class="string">&#x27;http://localhost/notes/pages/styled_notes/&#x27;</span> + file)</span><br><span class="line">    ids.append(file[:-<span class="number">9</span>])</span><br><span class="line">    keys_list = ids</span><br><span class="line">values_list = linques</span><br><span class="line">zip_iterator = <span class="built_in">zip</span>(keys_list, values_list)</span><br><span class="line">pages = <span class="built_in">dict</span>(zip_iterator)</span><br></pre></td></tr></table></figure></li>
<li>Then I add them to the database.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = connect(</span><br><span class="line">            host=<span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">            user=<span class="string">&quot;mic&quot;</span>,</span><br><span class="line">            password=<span class="string">&quot;xxxx&quot;</span>,</span><br><span class="line">            database=<span class="string">&quot;notes_web&quot;</span>)</span><br><span class="line">    cur = conn.cursor()</span><br><span class="line">    <span class="keyword">for</span> key, value <span class="keyword">in</span> pages.items():</span><br><span class="line">        answers = [<span class="built_in">int</span>(key), value]</span><br><span class="line">        query = <span class="string">&quot;INSERT IGNORE INTO notes_web (id, url) VALUES(%s, %s)&quot;</span></span><br><span class="line">        cur.execute(query, answers)</span><br><span class="line">        conn.commit()</span><br><span class="line"><span class="keyword">except</span> Error <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Error while connecting to db&quot;</span>, e)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="keyword">if</span>(conn):</span><br><span class="line">        conn.close()</span><br></pre></td></tr></table></figure></li>
</ol>
<p>As always, complete file.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> mysql.connector <span class="keyword">import</span> connect, Error</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">urls</span>():</span></span><br><span class="line">    path = <span class="string">&#x27;/srv/http/notes/pages/styled_notes&#x27;</span></span><br><span class="line">    files = os.listdir(path)</span><br><span class="line">    linques = []</span><br><span class="line">    ids = []</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">        linques.append(<span class="string">&#x27;http://localhost/notes/pages/styled_notes/&#x27;</span> + file)</span><br><span class="line">        ids.append(file[:-<span class="number">9</span>])</span><br><span class="line">        keys_list = ids</span><br><span class="line">    values_list = linques</span><br><span class="line">    zip_iterator = <span class="built_in">zip</span>(keys_list, values_list)</span><br><span class="line">    pages = <span class="built_in">dict</span>(zip_iterator)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        conn = connect(</span><br><span class="line">                host=<span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">                user=<span class="string">&quot;mic&quot;</span>,</span><br><span class="line">                password=<span class="string">&quot;xxxx&quot;</span>,</span><br><span class="line">                database=<span class="string">&quot;notes_web&quot;</span>)</span><br><span class="line">        cur = conn.cursor()</span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> pages.items():</span><br><span class="line">            answers = [<span class="built_in">int</span>(key), value]</span><br><span class="line">            query = <span class="string">&quot;INSERT IGNORE INTO notes_web (id, url) VALUES(%s, %s)&quot;</span></span><br><span class="line">            cur.execute(query, answers)</span><br><span class="line">            conn.commit()</span><br><span class="line">    <span class="keyword">except</span> Error <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Error while connecting to db&quot;</span>, e)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">if</span>(conn):</span><br><span class="line">            conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    urls()</span><br></pre></td></tr></table></figure>
<hr>
<h2><span id="6-update_tagspy">6 - update_tags.py</span></h2><p>This was a difficult one to get right. For some reason, I wasn’t being able to update the notes tags into the already existent rows. MySQL would start new entries with new content. Which is, dare I say it? ‘No bueno.’<br>But I finally got it right, and this is what I did.  </p>
<ol>
<li>Here we open the old cli app database and go looking for the tag information linked to the notes already present in the web app.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = connect(</span><br><span class="line">        host=<span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">        user=<span class="string">&quot;mic&quot;</span>,</span><br><span class="line">        password=<span class="string">&quot;xxxx&quot;</span>,</span><br><span class="line">        database=<span class="string">&quot;notes&quot;</span>)</span><br><span class="line">    cur = conn.cursor()</span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&#x27;update_tags.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">    lines = f.readlines()</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">        query = <span class="string">&quot;SELECT ntid, k1, k2, k3 FROM notes.notes WHERE ntid = &quot;</span> + line</span><br><span class="line">        cur.execute(query)</span><br><span class="line">        records = cur.fetchall()</span><br></pre></td></tr></table></figure></li>
<li>Then we write the content to a file.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> records:</span><br><span class="line">            f = <span class="built_in">open</span>(<span class="string">&#x27;tags_list.txt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">            f.write(row[<span class="number">1</span>]),</span><br><span class="line">            f.write(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            f.write(row[<span class="number">2</span>]),</span><br><span class="line">            f.write(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            f.write(row[<span class="number">3</span>]),</span><br><span class="line">            f.write(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            f.write(<span class="built_in">str</span>(row[<span class="number">0</span>]))</span><br><span class="line">            f.write(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> Error <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Error while connecting to db&quot;</span>, e)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="keyword">if</span>(conn):</span><br><span class="line">        conn.close()</span><br></pre></td></tr></table></figure></li>
<li>Then I connect to the web app database, open the aforementioned file, turn it into a python list, clean it and group it in parties of four items. One id and three content tags.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = connect(host=<span class="string">&quot;localhost&quot;</span>, user=<span class="string">&quot;mic&quot;</span>, password=<span class="string">&quot;xxxx&quot;</span>, database=<span class="string">&quot;notes_web&quot;</span>)</span><br><span class="line">    cur = conn.cursor()</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;tags_list.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        content_list = f.readlines()</span><br><span class="line">    clean_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> content_list:</span><br><span class="line">        clean_list.append(i.strip())</span><br><span class="line">    n = <span class="number">4</span></span><br><span class="line">    final = [clean_list[i * n:(i + <span class="number">1</span>) * n] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>((<span class="built_in">len</span>(clean_list) + n - <span class="number">1</span>) // n)]</span><br><span class="line">    <span class="built_in">print</span>(final)</span><br></pre></td></tr></table></figure></li>
<li>Finally we pass the items as variables in a SQL query to the web app database, and everything is OK.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">for</span> <span class="built_in">list</span> <span class="keyword">in</span> final:</span><br><span class="line">        query1 = <span class="string">&quot;UPDATE notes_web SET k1 = &#x27;&quot;</span> + <span class="built_in">list</span>[<span class="number">0</span>] + <span class="string">&quot;&#x27;, k2 = &#x27;&quot;</span> + <span class="built_in">list</span>[<span class="number">1</span>] + <span class="string">&quot;&#x27;, k3 = &#x27;&quot;</span> + <span class="built_in">list</span>[<span class="number">2</span>] + <span class="string">&quot;&#x27; WHERE id = &quot;</span> + <span class="built_in">list</span>[<span class="number">3</span>]</span><br><span class="line">        <span class="built_in">print</span>(query1)</span><br><span class="line">        cur.execute(query1)</span><br><span class="line">        conn.commit()</span><br><span class="line"><span class="keyword">except</span> Error <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Error while connecting to db&quot;</span>, e)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="keyword">if</span>(conn):</span><br><span class="line">        conn.close()</span><br></pre></td></tr></table></figure></li>
</ol>
<p>Full Text:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mysql.connector <span class="keyword">import</span> connect, Error</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_tags</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        conn = connect(</span><br><span class="line">            host=<span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">            user=<span class="string">&quot;mic&quot;</span>,</span><br><span class="line">            password=<span class="string">&quot;xxxx&quot;</span>,</span><br><span class="line">            database=<span class="string">&quot;notes&quot;</span>)</span><br><span class="line">        cur = conn.cursor()</span><br><span class="line">        f = <span class="built_in">open</span>(<span class="string">&#x27;update_tags.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">        lines = f.readlines()</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">            query = <span class="string">&quot;SELECT ntid, k1, k2, k3 FROM notes.notes WHERE ntid = &quot;</span> + line</span><br><span class="line">            cur.execute(query)</span><br><span class="line">            records = cur.fetchall()</span><br><span class="line">            <span class="keyword">for</span> row <span class="keyword">in</span> records:</span><br><span class="line">                f = <span class="built_in">open</span>(<span class="string">&#x27;tags_list.txt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">                f.write(row[<span class="number">1</span>]),</span><br><span class="line">                f.write(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">                f.write(row[<span class="number">2</span>]),</span><br><span class="line">                f.write(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">                f.write(row[<span class="number">3</span>]),</span><br><span class="line">                f.write(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">                f.write(<span class="built_in">str</span>(row[<span class="number">0</span>]))</span><br><span class="line">                f.write(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> Error <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Error while connecting to db&quot;</span>, e)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">if</span>(conn):</span><br><span class="line">            conn.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        conn = connect(host=<span class="string">&quot;localhost&quot;</span>, user=<span class="string">&quot;mic&quot;</span>, password=<span class="string">&quot;xxxx&quot;</span>, database=<span class="string">&quot;notes_web&quot;</span>)</span><br><span class="line">        cur = conn.cursor()</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;tags_list.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            content_list = f.readlines()</span><br><span class="line">        clean_list = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> content_list:</span><br><span class="line">            clean_list.append(i.strip())</span><br><span class="line">        n = <span class="number">4</span></span><br><span class="line">        final = [clean_list[i * n:(i + <span class="number">1</span>) * n] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>((<span class="built_in">len</span>(clean_list) + n - <span class="number">1</span>) // n)]</span><br><span class="line">        <span class="comment"># print(final)</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">list</span> <span class="keyword">in</span> final:</span><br><span class="line">            query1 = <span class="string">&quot;UPDATE notes_web SET k1 = &#x27;&quot;</span> + <span class="built_in">list</span>[<span class="number">0</span>] + <span class="string">&quot;&#x27;, k2 = &#x27;&quot;</span> + <span class="built_in">list</span>[<span class="number">1</span>] + <span class="string">&quot;&#x27;, k3 = &#x27;&quot;</span> + <span class="built_in">list</span>[<span class="number">2</span>] + <span class="string">&quot;&#x27; WHERE id = &quot;</span> + <span class="built_in">list</span>[<span class="number">3</span>]</span><br><span class="line">            <span class="built_in">print</span>(query1)</span><br><span class="line">            cur.execute(query1)</span><br><span class="line">            conn.commit()</span><br><span class="line">    <span class="keyword">except</span> Error <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Error while connecting to db&quot;</span>, e)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">if</span>(conn):</span><br><span class="line">            conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    update_tags()</span><br></pre></td></tr></table></figure>
</div></div><div class="footer"><div class="footer-copyright">Theme By <a target="_blank" rel="noopener" href="https://github.com/shinux/hexo-theme-adoubi">Adoubi</a> , Powered By Hexo.</div></div></body></html>