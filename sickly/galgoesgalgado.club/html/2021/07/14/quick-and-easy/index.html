<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>quick_and_easy</title><link rel="stylesheet" href="/css/normalize.css"><link rel="stylesheet" href="/css/heti.min.css"><link rel="stylesheet" href="/css/hexo-theme-adoubi.css"><link rel="icon" href="/images/favicon.ico"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="" type="application/atom+xml">
</head><body><div class="header"><a class="github-link" target="_blank" rel="noopener" href="https://notabug.org/micaldas"><img class="github-image" src="/images/Aquicon-Github-small.png"></a><a class="email-link" href="mailto:mclds@protonmail.com"><img class="email-image" src="/images/email-small.png"></a><a class="subscribe-link" href="/atom.xml"><img class="subscribe-image" src="/images/subscribe-small.png"></a></div><div class="content"><div class="post-item"></div><h2 class="post-title-wrapper"><p class="post-title">quick_and_easy</p></h2><div class="post-date"><time datetime="2021-07-14T20:22:00.000Z">2021-07-14</time></div><div class="post-content"><p>I just had a disconcertingly pleasurable experience with python.<br>I was expecting toils and tribulations, but everything worked beautifully at the first try, and now I’m charged with a warrior mindset that<br>has no outlet for its intensity.<br>So I think I’ll just write a post about it.<br>I am now, for no weighty reason, trying to create web presences of my cli apps. It’s a way for me to learn a bit more of PHP, CSS, HTML and, eventually, and probably kicking and screaming; JavaScript.<br>I’m trying to replicate their functionalities in a web environment. Up until now it has been fun. PHP is a delight to learn, and web design is extremely tactile.<br>You have almost immediately a, if not physical, visible result to your efforts.<br>Until now I’ve been avoiding frameworks and such like, with the objective of having to use the core building blocks of web design. What is lost in sophistication,<br>is returned by creating a sound knowledge base. Or so we hope.<br>One of the apps that I use more frequently is my notes app.<br>It writes the note in a temporary vim file and stores it in a MySQL database. So all my notes are in txt files, written with syntax appropriated to that environment.<br>For example; here’s a note that looks very much like all the others:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">To open a port for a application in linux,</span><br><span class="line">do the following:</span><br><span class="line">-----------------------------------------------</span><br><span class="line">iptables -A INPUT -p tcp --dport 4000 -j ACCEPT</span><br><span class="line">sudo systemctl restart iptables</span><br><span class="line">------------------------------------------------</span><br><span class="line">To test it, do this:</span><br><span class="line">------------------------------------------------</span><br><span class="line">ls | nc -l -p 4000</span><br><span class="line">------------------------------------------------</span><br><span class="line">and now in another terminal:</span><br><span class="line">------------------------------------------------</span><br><span class="line">telnet localhost &lt;port number&gt;</span><br><span class="line">------------------------------------------------</span><br><span class="line"> https://tinyurl.com/yjjk4n8v</span><br></pre></td></tr></table></figure>
<p>As you can see, I use dashes to separate code from comments and generally make it look less boring. I never gave it much thought as it seemed to me to be a perfectly reasonable way to write notes. And since they are to be used by only by  me, this didn’t bothered me at all. Or, at least, until I tried to convert the notes to HTML.<br>The lines occupied all of the screen, stretched for several lines and generally destroyed the layout.<br>So I needed to remove the dashes from around 130 database entries and create clean, legible HTML versions, to use in a putative notes site.<br>When I was rummaging through MySQL documentation, explaining to me how to store the result of a SQL query into a file, (a process that seemed complicated and really not what I needed), I remembered that every time I used the cli app in “see_all” mode, I was in fact downloading all the database. All that was needed was to go from the database to files.<br>In the end, I ended doing this:  </p>
<ol>
<li>I connected to the database and selected everything:<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">notes</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        conn = connect(</span><br><span class="line">                host=<span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">                user=<span class="string">&quot;mic&quot;</span>,</span><br><span class="line">                password=<span class="string">&quot;xxxx&quot;</span>,</span><br><span class="line">                database=<span class="string">&quot;notes&quot;</span>)</span><br><span class="line">        cur = conn.cursor()</span><br><span class="line">        query = <span class="string">&#x27;SELECT * FROM notes&#x27;</span></span><br><span class="line">        cur.execute(query,)</span><br><span class="line">        records = cur.fetchall()</span><br></pre></td></tr></table></figure></li>
<li>created a value in the array:<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> records:</span><br></pre></td></tr></table></figure></li>
<li>created a string with the ID field of the database concatenated with ‘.txt’. In the end you end up with files like ‘299.txt’.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file = <span class="built_in">str</span>(row[<span class="number">0</span>]) + <span class="string">&#x27;.txt&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li>opened a file to write this string as a title,<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(file, <span class="string">&#x27;w&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
<li>and wrote in it the notes field, that is the sixth field in the database.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f.write(<span class="built_in">str</span>(row[<span class="number">5</span>]))</span><br></pre></td></tr></table></figure>
I was expecting that what I was doing was programming wishful thinking. That the opened db would never interact with files, or some other typical impediment I face when trying to do things I haven’t really studied or understood deeply.<br>But this time it was immediate. When I saw all the files that it created, I couldn’t believe that had been so easy.<br>Thank God for little blessings.<br>Then I had to run the script through a hundred and change files, to clean them. But this seemed, and was, much easier.<br>This is what I did:  </li>
<li>First I created the function that would do the replacement:<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">replace</span>(<span class="params">filepath</span>):</span></span><br></pre></td></tr></table></figure></li>
<li>Then I defined that the file to be cleaned would be called filepath, as it will be needed later on to find the files.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">input</span> = <span class="built_in">open</span>(filepath, <span class="string">&#x27;rt&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
<li>Decided that the output files would have still the id’s of the database, appending it a ‘_clean’ suffix.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">new_file = filepath + <span class="string">&#x27;_clean&#x27;</span></span><br><span class="line">output = <span class="built_in">open</span>(new_file, <span class="string">&#x27;wt&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
<li>Here I replace the dashes by spaces and close the files.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">input</span>:</span><br><span class="line">    output.write(line.replace(<span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27; &#x27;</span>))</span><br><span class="line"><span class="built_in">input</span>.close()</span><br><span class="line">output.close()</span><br></pre></td></tr></table></figure></li>
<li>This is the directory where all the files to be cleaned are located:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dir</span> = <span class="string">&#x27;/srv/http/notes/before&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li>Here starts the loop that states that, for every file found in said directory:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(<span class="built_in">dir</span>):</span><br></pre></td></tr></table></figure></li>
<li>create a URL joining the path of the directory plus the name of the file:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filepath = os.path.join(<span class="built_in">dir</span>, filename)</span><br></pre></td></tr></table></figure></li>
<li>and finally use the function defined above on this new path object:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replace(filepath)</span><br></pre></td></tr></table></figure></li>
</ol>
<p>And that is it. I hope this may be of some use to anyone. For me it was a pleasant surprise.<br>I’ll leave you with the whole code of the files:  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot; This module will download all note entries in notes db and put them in files &quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> mysql.connector <span class="keyword">import</span> connect, Error</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">notes</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        conn = connect(</span><br><span class="line">                host=<span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">                user=<span class="string">&quot;mic&quot;</span>,</span><br><span class="line">                password=<span class="string">&quot;xxxx&quot;</span>,</span><br><span class="line">                database=<span class="string">&quot;notes&quot;</span>)</span><br><span class="line">        cur = conn.cursor()</span><br><span class="line">        query = <span class="string">&#x27;SELECT * FROM notes&#x27;</span></span><br><span class="line">        cur.execute(query,)</span><br><span class="line">        records = cur.fetchall()</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> records:</span><br><span class="line">            file = <span class="built_in">str</span>(row[<span class="number">0</span>]) + <span class="string">&#x27;.txt&#x27;</span></span><br><span class="line">            f = <span class="built_in">open</span>(file, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">            f.write(<span class="built_in">str</span>(row[<span class="number">5</span>]))</span><br><span class="line">            f.close()</span><br><span class="line">    <span class="keyword">except</span> Error <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Error while connecting to db&quot;</span>, e)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">if</span>(conn):</span><br><span class="line">            conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    notes()</span><br></pre></td></tr></table></figure>

<p>And the function that cleaned the files:  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot; Script to erase dashes from db entries and replace them with spaces. &quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">replace</span>(<span class="params">filepath</span>):</span></span><br><span class="line">    <span class="built_in">input</span> = <span class="built_in">open</span>(filepath, <span class="string">&#x27;rt&#x27;</span>)</span><br><span class="line">    new_file = filepath + <span class="string">&#x27;_clean&#x27;</span></span><br><span class="line">    output = <span class="built_in">open</span>(new_file, <span class="string">&#x27;wt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">input</span>:</span><br><span class="line">        output.write(line.replace(<span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27; &#x27;</span>))</span><br><span class="line">    <span class="built_in">input</span>.close()</span><br><span class="line">    output.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">dir</span> = <span class="string">&#x27;/srv/http/notes/before&#x27;</span></span><br><span class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(<span class="built_in">dir</span>):</span><br><span class="line">    filepath = os.path.join(<span class="built_in">dir</span>, filename)</span><br><span class="line">    replace(filepath)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    replace(filepath)</span><br></pre></td></tr></table></figure>
<hr>
<h2><span id="update">UPDATE</span></h2><p>For completeness sake, I returned to this post to add the file that converts text files to HTML. I used a very nifty app called <a target="_blank" rel="noopener" href="http://txt2html.sourceforge.net/txt2html.html#files">txt2html</a> that did much of the work. As it is an app not a library, I had to use Python’s subprocess to run it. But, all in all, easy peasy.  </p>
<ol>
<li>Define the subprocess command. Here we call txt2html, defining as the original files the ones set by filepath, and define the output files with the same name plus an html suffix.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd = <span class="string">&#x27;txt2html --infile &#x27;</span> + filepath + <span class="string">&#x27; --outfile &#x27;</span> + filepath + <span class="string">&#x27;.html&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li>Next we run the subprocess command with the ‘shell=True’ flag, that ensures that the behaviour is exactly the same as if running on shell. This is very frowned upon, but in my limited experience, things tend to work with this flag and not to, when it’s not used. So, until anyone explains me better why this is so evil, I’ll keep using it.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">subprocess.run(cmd, shell=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></li>
<li>The rest of the process is similar to the other file, so there’s nothing to add here.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dir</span> = <span class="string">&#x27;/srv/http/notes/clean&#x27;</span></span><br><span class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(<span class="built_in">dir</span>):</span><br><span class="line">    filepath = os.path.join(<span class="built_in">dir</span>, filename)</span><br><span class="line">    convert(filepath)</span><br></pre></td></tr></table></figure></li>
</ol>
<p>The full code:  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot; Script to convert text files in html. &quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert</span>(<span class="params">filepath</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Convert txt files by running them through a loop that converts them to html &quot;&quot;&quot;</span></span><br><span class="line">    cmd = <span class="string">&#x27;txt2html --infile &#x27;</span> + filepath + <span class="string">&#x27; --outfile &#x27;</span> + filepath + <span class="string">&#x27;.html&#x27;</span></span><br><span class="line">    subprocess.run(cmd, shell=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">dir</span> = <span class="string">&#x27;/srv/http/notes/clean&#x27;</span></span><br><span class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(<span class="built_in">dir</span>):</span><br><span class="line">    filepath = os.path.join(<span class="built_in">dir</span>, filename)</span><br><span class="line">    convert(filepath)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    convert(filepath)</span><br></pre></td></tr></table></figure>
</div></div><div class="footer"><div class="footer-copyright">Theme By <a target="_blank" rel="noopener" href="https://github.com/shinux/hexo-theme-adoubi">Adoubi</a> , Powered By Hexo.</div></div></body></html>