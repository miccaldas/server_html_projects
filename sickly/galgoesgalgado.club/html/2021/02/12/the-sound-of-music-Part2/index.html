<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>The Sound of Music Part2</title><link rel="stylesheet" href="/css/normalize.css"><link rel="stylesheet" href="/css/heti.min.css"><link rel="stylesheet" href="/css/hexo-theme-adoubi.css"><link rel="icon" href="/images/favicon.ico"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="" type="application/atom+xml">
</head><body><div class="header"><a class="github-link" target="_blank" rel="noopener" href="https://notabug.org/micaldas"><img class="github-image" src="/images/Aquicon-Github-small.png"></a><a class="email-link" href="mailto:mclds@protonmail.com"><img class="email-image" src="/images/email-small.png"></a><a class="subscribe-link" href="/atom.xml"><img class="subscribe-image" src="/images/subscribe-small.png"></a></div><div class="content"><div class="post-item"></div><h2 class="post-title-wrapper"><p class="post-title">The Sound of Music Part2</p></h2><div class="post-date"><time datetime="2021-02-12T22:19:32.000Z">2021-02-12</time></div><div class="post-content"><p>A funny thing happened on my way here.<br>As I said in the last post, there were things that I didn’t liked on the last incarnation of the modules for the player commands:  </p>
<ol>
<li>I was calling subprocess when I could solve all my needs just using <a target="_blank" rel="noopener" href="https://psutil.readthedocs.io/en/latest/">Psutil</a>, which I was already using anyway, but not to do the search for the pid of the player’s process.  </li>
<li>The bash command I was using, had some features that I copied without a critical attitude or any knowledge of what they meant. It worked just fine, but I felt that I should use a command I can thoroughly understand.  </li>
<li>The code for each command was 99% identical to the next, and divided in different modules. I thought that this could benefit from a ‘tightening up’.  </li>
</ol>
<p>When I started looking into this I found some surprises.<br>The old command code was built to find the ffplay process from the ffmpeg library and, as I remember, it worked fine. So at some moment in time, the player was using ffplay. Not anymore.<br>Now when I tried to find a ffplay process, nothing came up. Apparently the player is working fine although not using ffplay or ffmpeg, as I couldn’t find any processes by that name. The only process I found was in the name of ‘python’ and it referred to the player.py file.<br>But, truthfully, I’m not sure anymore that these commands ever worked. I have a very hazy idea that they were written but not tested, or that I found something wrong and just forgot to correct it. I don’t know. Too much time, too much drugs, everything turns to a soupy mash of days.<br>But I soon realized that this mystery could be a blessing. Instead of wasting time trying to retrace my steps through alterations that I didn’t document and did half-heartedly, I could start anew. A clean slate. And that is what I did.  </p>
<hr>
<h2><span id="the-commands-module">The Commands Module</span></h2><ol>
<li>Created a ‘commands.py’ module where I put all of the interactions with the player in a class. This is its code:  </li>
<li>Imported only psutil for the sourcing of the pid and the commands proper.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> psutil</span><br></pre></td></tr></table></figure></li>
<li>Created a class imaginatively called ‘Commands’. At first I used a <strong>init</strong> function, but soon discovered that it was more of a nuisance than a asset. I’m never sure if this is a very terrible thing to do (create a class without <strong>init</strong>) or just a venial sin, but in this case, I went without.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Commands</span>:</span></span><br></pre></td></tr></table></figure></li>
<li>Created a function to search for the pid of the python process for the player.py file.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Find the process pid with psutil&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></li>
<li> Create a list to house the processes output,<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lspid = []</span><br></pre></td></tr></table></figure></li>
<li>the player name process is always python,<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name = <span class="string">&#x27;python&#x27;</span> </span><br></pre></td></tr></table></figure></li>
<li>for item in list of iterable processes names,<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> psutil.process_iter([<span class="string">&#x27;name&#x27;</span>]):</span><br></pre></td></tr></table></figure></li>
<li>if process name is the same as python,<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> p.info[<span class="string">&#x27;name&#x27;</span>] == name:</span><br></pre></td></tr></table></figure></li>
<li>append to list,<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lspid.append(p)</span><br></pre></td></tr></table></figure></li>
<li>the player pid seems to be always the first on the list of processes.  As the list items are psutil.Process objects, you can add to it the pid method to return only the pid.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">player_pid = lspid[<span class="number">0</span>].pid</span><br></pre></td></tr></table></figure></li>
<li>Creates a psutil.Process with just the pid.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p = psutil.Process(<span class="built_in">int</span>(player_pid))</span><br></pre></td></tr></table></figure></li>
<li>Return the pid.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> p</span><br></pre></td></tr></table></figure></li>
<li>Function to kill the process. Importing the find() function and adding to it the kill() method from psutil. ‘Mata’ means kill in Portuguese.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mata</span>(<span class="params">self</span>):</span></span><br><span class="line">    find = self.find()</span><br><span class="line">    find.kill()</span><br></pre></td></tr></table></figure></li>
<li>Function to suspend process. Same procedure as the last function.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">suspend</span>(<span class="params">self</span>):</span></span><br><span class="line">    find = self.find()</span><br><span class="line">    find.suspend()</span><br></pre></td></tr></table></figure></li>
<li>Function to resume process. More of the same.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">resume</span>(<span class="params">self</span>):</span></span><br><span class="line">    find = self.find()</span><br><span class="line">    find.resume()</span><br></pre></td></tr></table></figure></li>
</ol>
<p>And here goes the complete code for this module:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot; Module that aggregates all commands. find() gives the pid and the other functions use psutil to do various manipulations &quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> psutil</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Commands</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;Find the process pid with psutil&quot;&quot;&quot;</span></span><br><span class="line">        lspid = []                                  <span class="comment"># Create a list to house the processes output</span></span><br><span class="line">        name = <span class="string">&#x27;python&#x27;</span>                             <span class="comment"># The player name process is always python</span></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> psutil.process_iter([<span class="string">&#x27;name&#x27;</span>]):     <span class="comment"># For item in list of iterable processes names,</span></span><br><span class="line">            <span class="keyword">if</span> p.info[<span class="string">&#x27;name&#x27;</span>] == name:              <span class="comment"># If process name is the same as python,</span></span><br><span class="line">                lspid.append(p)                     <span class="comment"># Append to list</span></span><br><span class="line">        player_pid = lspid[<span class="number">0</span>].pid                   <span class="comment"># The player pid seems to be always the first on the list of processes.</span></span><br><span class="line">        <span class="comment"># As the list items are psutil.Process objects, you can add to it the pid method to return only the pid</span></span><br><span class="line">        p = psutil.Process(<span class="built_in">int</span>(player_pid))         <span class="comment"># Creates a psutil.Process with just the pid</span></span><br><span class="line">        <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mata</span>(<span class="params">self</span>):</span></span><br><span class="line">        find = self.find()</span><br><span class="line">        find.kill()                                 <span class="comment"># https://psutil.readthedocs.io/en/latest/</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">suspend</span>(<span class="params">self</span>):</span></span><br><span class="line">        find = self.find()</span><br><span class="line">        find.suspend()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">resume</span>(<span class="params">self</span>):</span></span><br><span class="line">        find = self.find()</span><br><span class="line">        find.resume()</span><br></pre></td></tr></table></figure>
<hr>
<h2><span id="the-main-module">The Main Module</span></h2><p>If you read more than one post here, you already know that my memory is far from being my greatest asset. More of a hindrance really.<br>So I tend to shy away from UI solutions that entail remembering commands. What I do is use prompt libraries to present the options as multiple choice questionnaire to the user, and link the choices to the respective functions.    </p>
<ol>
<li>Regarding imports, I take from <strong>future</strong>, unicode literals. Needed for <a target="_blank" rel="noopener" href="https://questionary.readthedocs.io/en/stable/">questionary</a>, the command line interface library; I get sys to have a sys.exit option for the user, the Commands class from the module we’ve talked above; the player module which houses the player, funnily enough; and finally the questionary library.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> unicode_literals</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> commands <span class="keyword">import</span> Commands</span><br><span class="line"><span class="keyword">from</span> player <span class="keyword">import</span> player</span><br><span class="line"><span class="keyword">import</span> questionary</span><br></pre></td></tr></table></figure></li>
<li>Create the questionary object,<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">resposta = questionary.select(</span><br><span class="line">        <span class="string">&#x27;What do you want do to? &#x27;</span>,</span><br><span class="line">        choices=[</span><br><span class="line">            <span class="string">&#x27;Start the Player&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Stop the Player&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Suspend the Player&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Resume the Player&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Exit&#x27;</span></span><br><span class="line">            ]).ask()</span><br></pre></td></tr></table></figure></li>
<li>and link the choices to their respective functions or methods.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> resposta == <span class="string">&#x27;Start the Player&#x27;</span>:</span><br><span class="line">    player()</span><br><span class="line"><span class="keyword">if</span> resposta == <span class="string">&#x27;Stop the Player&#x27;</span>:</span><br><span class="line">    com = Commands()</span><br><span class="line">    com.mata()</span><br><span class="line"><span class="keyword">if</span> resposta == <span class="string">&#x27;Suspend the Player&#x27;</span>:</span><br><span class="line">    com = Commands()</span><br><span class="line">    com.suspend()</span><br><span class="line"><span class="keyword">if</span> resposta == <span class="string">&#x27;Resume the Player&#x27;</span>:</span><br><span class="line">    com = Commands()</span><br><span class="line">    com.resume()</span><br><span class="line"><span class="keyword">if</span> resposta == <span class="string">&#x27;Exit&#x27;</span>:</span><br><span class="line">    sys.exit()</span><br></pre></td></tr></table></figure></li>
</ol>
<p>Here’s the complete code:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot; Here we call the commands functions from the Commands class, and present them to the user as a multiple choice questionart &quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> unicode_literals</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> commands <span class="keyword">import</span> Commands</span><br><span class="line"><span class="keyword">from</span> player <span class="keyword">import</span> player</span><br><span class="line"><span class="keyword">import</span> questionary</span><br><span class="line"></span><br><span class="line">resposta = questionary.select(</span><br><span class="line">        <span class="string">&#x27;What do you want do to? &#x27;</span>,</span><br><span class="line">        choices=[</span><br><span class="line">            <span class="string">&#x27;Start the Player&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Stop the Player&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Suspend the Player&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Resume the Player&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Exit&#x27;</span></span><br><span class="line">            ]).ask()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> resposta == <span class="string">&#x27;Start the Player&#x27;</span>:</span><br><span class="line">    player()</span><br><span class="line"><span class="keyword">if</span> resposta == <span class="string">&#x27;Stop the Player&#x27;</span>:</span><br><span class="line">    com = Commands()   <span class="comment"># It is always needed to instantiate the class. Only then can you access the methods</span></span><br><span class="line">    com.mata()</span><br><span class="line"><span class="keyword">if</span> resposta == <span class="string">&#x27;Suspend the Player&#x27;</span>:</span><br><span class="line">    com = Commands()</span><br><span class="line">    com.suspend()</span><br><span class="line"><span class="keyword">if</span> resposta == <span class="string">&#x27;Resume the Player&#x27;</span>:</span><br><span class="line">    com = Commands()</span><br><span class="line">    com.resume()</span><br><span class="line"><span class="keyword">if</span> resposta == <span class="string">&#x27;Exit&#x27;</span>:</span><br><span class="line">    sys.exit()</span><br></pre></td></tr></table></figure>
<hr>
<h2><span id="the-player-module">The Player Module</span></h2><p>For completeness sake, here goes the player module. It uses the <a target="_blank" rel="noopener" href="https://github.com/jiaaro/pydub/blob/master/API.markdown">Pydub</a> library to play the music and has some folders and file manipulations to access the music.<br>It also uses a threading function to be able to show a progress bar through <a target="_blank" rel="noopener" href="https://github.com/tqdm/tqdm">tqdm</a>.  </p>
<ol>
<li>These are the imports needed. os for file/folder manipulation, time to use sleep for the progress bar, threading for the reasons explained above, pydub for playing the content, tqdm for the bar and <a target="_blank" rel="noopener" href="https://click.palletsprojects.com/en/7.x/">click</a>, for prettiness sake.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot; Module to choose and reproduce music kept in the computer &quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> pydub <span class="keyword">import</span> AudioSegment</span><br><span class="line"><span class="keyword">from</span> pydub.playback <span class="keyword">import</span> play</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> click</span><br></pre></td></tr></table></figure></li>
<li>Define the function,<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">player</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; The program should present the content of the &#x27;music&#x27; folder, create a prompt for the user to choose from, and reproduce the files</span></span><br><span class="line"><span class="string">    with a timer.&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></li>
<li>present the music files to the user,<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://stackoverflow.com/questions/5817209/browse-files-and-subfolders-in-python</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> os.scandir(<span class="string">&quot;/home/mic/music&quot;</span>):</span><br><span class="line">    <span class="keyword">if</span> i.is_file():</span><br><span class="line">        <span class="built_in">print</span>(i.path)</span><br><span class="line">    <span class="keyword">elif</span> i.is_dir():</span><br><span class="line">        <span class="built_in">print</span>(i.path)</span><br></pre></td></tr></table></figure></li>
<li>I love isometric ASCII lettering,<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    <span class="built_in">print</span>(<span class="string">r&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">      ___           ___           ___                       ___                    ___                       ___                       ___           ___</span></span><br><span class="line"><span class="string">     /\  \         /\  \         /\__\                     /\__\                  /\  \                     /\  \                     /\__\         /\  \</span></span><br><span class="line"><span class="string">    |::\  \        \:\  \       /:/ _/_       ___         /:/  /                 /::\  \                   /::\  \         ___       /:/ _/_       /::\  \</span></span><br><span class="line"><span class="string">    |:|:\  \        \:\  \     /:/ /\  \     /\__\       /:/  /                 /:/\:\__\                 /:/\:\  \       /|  |     /:/ /\__\     /:/\:\__\</span></span><br><span class="line"><span class="string">  __|:|\:\  \   ___  \:\  \   /:/ /::\  \   /:/__/      /:/  /  ___            /:/ /:/  /  ___     ___   /:/ /::\  \     |:|  |    /:/ /:/ _/_   /:/ /:/  /</span></span><br><span class="line"><span class="string"> /::::|_\:\__\ /\  \  \:\__\ /:/_/:/\:\__\ /::\  \     /:/__/  /\__\          /:/_/:/  /  /\  \   /\__\ /:/_/:/\:\__\    |:|  |   /:/_/:/ /\__\ /:/_/:/__/___</span></span><br><span class="line"><span class="string"> \:\~~\  \/__/ \:\  \ /:/  / \:\/:/ /:/  / \/\:\  \__  \:\  \ /:/  /          \:\/:/  /   \:\  \ /:/  / \:\/:/  \/__/  __|:|__|   \:\/:/ /:/  / \:\/:::::/  /</span></span><br><span class="line"><span class="string">  \:\  \        \:\  /:/  /   \::/ /:/  /   ~~\:\/\__\  \:\  /:/  /            \::/__/     \:\  /:/  /   \::/__/      /::::\  \    \::/_/:/  /   \::/~~/~~~~</span></span><br><span class="line"><span class="string">   \:\  \        \:\/:/  /     \/_/:/  /       \::/  /   \:\/:/  /              \:\  \      \:\/:/  /     \:\  \      ~~~~\:\  \    \:\/:/  /     \:\~~\</span></span><br><span class="line"><span class="string">    \:\__\        \::/  /        /:/  /        /:/  /     \::/  /                \:\__\      \::/  /       \:\__\          \:\__\    \::/  /       \:\__\</span></span><br><span class="line"><span class="string">     \/__/         \/__/         \/__/         \/__/       \/__/                  \/__/       \/__/         \/__/           \/__/     \/__/         \/__/</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
<li>ask the user to choose an album. This is done by copy/pasting one of the results in the prompt,<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">escolha = <span class="built_in">str</span>(<span class="built_in">input</span>(click.style(<span class="string">&#x27; » What do you want to hear? :~ &#x27;</span>, fg=<span class="string">&#x27;green&#x27;</span>, bold=<span class="literal">True</span>)))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
<li>create a empty list to house the album chosen by the user.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">album = []</span><br></pre></td></tr></table></figure></li>
<li>append the individual song files to the list,<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> os.scandir(escolha):</span><br><span class="line">    <span class="keyword">if</span> i.is_file():</span><br><span class="line">        album.append(i.path)</span><br></pre></td></tr></table></figure></li>
<li>for each song in the album list,<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> song <span class="keyword">in</span> album:</span><br></pre></td></tr></table></figure></li>
<li>get only the music title,<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">musicas = os.path.basename(os.path.normpath(song))</span><br></pre></td></tr></table></figure></li>
<li>and print it,<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(click.style(musicas, fg=<span class="string">&#x27;bright_white&#x27;</span>, bold=<span class="literal">True</span>))</span><br></pre></td></tr></table></figure></li>
<li>Create a variable to house a AudioSegment object,<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sound = AudioSegment.from_file(song)</span><br></pre></td></tr></table></figure></li>
<li>start the threading process, point it to the play function of the sound variable and start threading,<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">threading.get_ident()</span><br><span class="line">t = threading.Thread(target=play, args=(sound,))</span><br><span class="line">t.start()</span><br></pre></td></tr></table></figure></li>
<li>create a variable with the song duration in seconds,<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dur = sound.duration_seconds</span><br></pre></td></tr></table></figure></li>
<li>and create the progress bar object, with percentage of time spent, elapsed and remaining, sleep for 1 second and continue<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> sec <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="built_in">int</span>(dur)), bar_format=<span class="string">&#x27;&#123;desc&#125;: &#123;percentage:.0f&#125;%|&#123;bar&#125; | &#123;elapsed&#125;&lt;&#123;remaining&#125;&#x27;</span>):</span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
</ol>
<p>Here is the full code:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot; Module to choose and reproduce music kept in the computer &quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> pydub <span class="keyword">import</span> AudioSegment</span><br><span class="line"><span class="keyword">from</span> pydub.playback <span class="keyword">import</span> play</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> click</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">player</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; The program should present the content of the &#x27;music&#x27; folder, create a prompt for the user to choose from, and reproduce the files</span></span><br><span class="line"><span class="string">    with a timer.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># https://stackoverflow.com/questions/5817209/browse-files-and-subfolders-in-python</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> os.scandir(<span class="string">&quot;/home/mic/music&quot;</span>):</span><br><span class="line">        <span class="keyword">if</span> i.is_file():</span><br><span class="line">            <span class="built_in">print</span>(i.path)</span><br><span class="line">        <span class="keyword">elif</span> i.is_dir():</span><br><span class="line">            <span class="built_in">print</span>(i.path)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">r&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">      ___           ___           ___                       ___                    ___                       ___                       ___           ___</span></span><br><span class="line"><span class="string">     /\  \         /\  \         /\__\                     /\__\                  /\  \                     /\  \                     /\__\         /\  \</span></span><br><span class="line"><span class="string">    |::\  \        \:\  \       /:/ _/_       ___         /:/  /                 /::\  \                   /::\  \         ___       /:/ _/_       /::\  \</span></span><br><span class="line"><span class="string">    |:|:\  \        \:\  \     /:/ /\  \     /\__\       /:/  /                 /:/\:\__\                 /:/\:\  \       /|  |     /:/ /\__\     /:/\:\__\</span></span><br><span class="line"><span class="string">  __|:|\:\  \   ___  \:\  \   /:/ /::\  \   /:/__/      /:/  /  ___            /:/ /:/  /  ___     ___   /:/ /::\  \     |:|  |    /:/ /:/ _/_   /:/ /:/  /</span></span><br><span class="line"><span class="string"> /::::|_\:\__\ /\  \  \:\__\ /:/_/:/\:\__\ /::\  \     /:/__/  /\__\          /:/_/:/  /  /\  \   /\__\ /:/_/:/\:\__\    |:|  |   /:/_/:/ /\__\ /:/_/:/__/___</span></span><br><span class="line"><span class="string"> \:\~~\  \/__/ \:\  \ /:/  / \:\/:/ /:/  / \/\:\  \__  \:\  \ /:/  /          \:\/:/  /   \:\  \ /:/  / \:\/:/  \/__/  __|:|__|   \:\/:/ /:/  / \:\/:::::/  /</span></span><br><span class="line"><span class="string">  \:\  \        \:\  /:/  /   \::/ /:/  /   ~~\:\/\__\  \:\  /:/  /            \::/__/     \:\  /:/  /   \::/__/      /::::\  \    \::/_/:/  /   \::/~~/~~~~</span></span><br><span class="line"><span class="string">   \:\  \        \:\/:/  /     \/_/:/  /       \::/  /   \:\/:/  /              \:\  \      \:\/:/  /     \:\  \      ~~~~\:\  \    \:\/:/  /     \:\~~\</span></span><br><span class="line"><span class="string">    \:\__\        \::/  /        /:/  /        /:/  /     \::/  /                \:\__\      \::/  /       \:\__\          \:\__\    \::/  /       \:\__\</span></span><br><span class="line"><span class="string">     \/__/         \/__/         \/__/         \/__/       \/__/                  \/__/       \/__/         \/__/           \/__/     \/__/         \/__/</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    escolha = <span class="built_in">str</span>(<span class="built_in">input</span>(click.style(<span class="string">&#x27; » What do you want to hear? :~ &#x27;</span>, fg=<span class="string">&#x27;green&#x27;</span>, bold=<span class="literal">True</span>)))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    album = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> os.scandir(escolha):</span><br><span class="line">        <span class="keyword">if</span> i.is_file():</span><br><span class="line">            album.append(i.path)</span><br><span class="line">    <span class="keyword">for</span> song <span class="keyword">in</span> album:</span><br><span class="line">        musicas = os.path.basename(os.path.normpath(song))</span><br><span class="line">        <span class="built_in">print</span>(click.style(musicas, fg=<span class="string">&#x27;bright_white&#x27;</span>, bold=<span class="literal">True</span>))</span><br><span class="line">        sound = AudioSegment.from_file(song)</span><br><span class="line">        threading.get_ident()</span><br><span class="line">        t = threading.Thread(target=play, args=(sound,))</span><br><span class="line">        t.start()</span><br><span class="line">        dur = sound.duration_seconds</span><br><span class="line">        <span class="keyword">for</span> sec <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="built_in">int</span>(dur)), bar_format=<span class="string">&#x27;&#123;desc&#125;: &#123;percentage:.0f&#125;%|&#123;bar&#125; | &#123;elapsed&#125;&lt;&#123;remaining&#125;&#x27;</span>):</span><br><span class="line">            sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    player()</span><br></pre></td></tr></table></figure>
</div></div><div class="footer"><div class="footer-copyright">Theme By <a target="_blank" rel="noopener" href="https://github.com/shinux/hexo-theme-adoubi">Adoubi</a> , Powered By Hexo.</div></div></body></html>