<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>the_notes_project</title><link rel="stylesheet" href="/css/normalize.css"><link rel="stylesheet" href="/css/heti.min.css"><link rel="stylesheet" href="/css/hexo-theme-adoubi.css"><link rel="icon" href="/images/favicon.ico"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="" type="application/atom+xml">
</head><body><div class="header"><a class="github-link" target="_blank" rel="noopener" href="https://notabug.org/micaldas"><img class="github-image" src="/images/Aquicon-Github-small.png"></a><a class="email-link" href="mailto:mclds@protonmail.com"><img class="email-image" src="/images/email-small.png"></a><a class="subscribe-link" href="/atom.xml"><img class="subscribe-image" src="/images/subscribe-small.png"></a></div><div class="content"><div class="post-item"></div><h2 class="post-title-wrapper"><p class="post-title">the_notes_project</p></h2><div class="post-date"><time datetime="2021-08-29T20:26:45.000Z">2021-08-29</time></div><div class="post-content"><p>Lately I returned to a project that had always some interesting challenges, my notes app. Because I already have something like two hundred and change notes, there is really no option but to mechanize all the steps. Doing it by hand, as I always do, is out of the question.<br>My objective is replicate my cli note taking app in a web setting. I already did this project, but the results were not very satisfactory, despite achieving everything I set out to do.<br>In broad strokes, to convert the app I need to:</p>
<ol>
<li>Take the notes from the database,</li>
<li>Convert them to markdown,</li>
<li>Do any changes needed to the content,</li>
<li>Convert them to html,</li>
<li>Put them in the app,</li>
<li>Update the database with new content URLs.</li>
<li>Make changes to the current functionalities, to accommodate the alterations.</li>
</ol>
<p>Unfortunately I didn’t do this documenting exercise when all was fresh in my mind, so, this all will be a archaeological in nature. Let’s hope we stay near the truth.<br>Although the project is not finished, it has a tendency to be more labour intensive than expected, and this list may change. I leave here a list of important project files, where they’re being used and what they do.</p>
 <br>

<table>
<thead>
<tr>
<th>Files</th>
<th>Sub-project</th>
<th>Objective</th>
</tr>
</thead>
<tbody><tr>
<td>html_converter.py</td>
<td>file_conversion</td>
<td>Converts markdown files to html.</td>
</tr>
<tr>
<td>md_converter.py</td>
<td>file_conversion</td>
<td>Converts database entries into markdown.</td>
</tr>
<tr>
<td>build_csv.py</td>
<td>csv_file_creation</td>
<td>Creates a list with the id of the notes and their URLs.</td>
</tr>
<tr>
<td>link_lst</td>
<td>csv_file_creation</td>
<td>File created by ‘build_csv.py’. Internal use.</td>
</tr>
<tr>
<td>id_lst</td>
<td>csv_file_creation</td>
<td>File created by ‘build_csv.py’. Internal use.</td>
</tr>
<tr>
<td>id_links.csv</td>
<td>csv_file_creation</td>
<td>File created by ‘build_csv.py’. Internal use.</td>
</tr>
<tr>
<td>csv_cleanup.py</td>
<td>csv_file_creation</td>
<td>Cleans the csv created automatically. Generates two lists: id’s and URLs.</td>
</tr>
<tr>
<td>build_csv.py</td>
<td>csv_file_creation</td>
<td>Writes a csv file with the two lists and uploads it to the database.</td>
</tr>
<tr>
<td>chg_wordcloud.py</td>
<td>wordcloud_tags</td>
<td>Several activities needed to insert our data in the svg file.</td>
</tr>
<tr>
<td>beautsoup2.txt</td>
<td>wordcloud_tags</td>
<td>File created by ‘chg_wordcloud.py’. Internal use.</td>
</tr>
<tr>
<td>complete_lines.txt</td>
<td>wordcloud_tags</td>
<td>File created by ‘chg_wordcloud.py’. Internal use.</td>
</tr>
<tr>
<td>comprehension_output</td>
<td>wordcloud_tags</td>
<td>File created by ‘chg_wordcloud.py’. Internal use.</td>
</tr>
<tr>
<td>lines_tags1.txt</td>
<td>wordcloud_tags</td>
<td>File created by ‘chg_wordcloud.py’. Internal use.</td>
</tr>
<tr>
<td>text_tags_order.txt</td>
<td>wordcloud_tags</td>
<td>File created by ‘chg_wordcloud.py’. Internal use.</td>
</tr>
<tr>
<td>wordcloud_linenumbers.py</td>
<td>wordcloud_tags</td>
<td>Defines what lines are to be edited in the svg file.</td>
</tr>
<tr>
<td>all_tags.txt</td>
<td>content_tags</td>
<td>Contains all ocurrences of tags. Regardless if they’re repeated or not.</td>
</tr>
<tr>
<td>sorted list.txt</td>
<td>content_tags</td>
<td>List of tags with no repeats.</td>
</tr>
</tbody></table>
<br>

<p>I’ll start by what is, more or less, the real beginning, a trove of notes, already in markdown, that I found inside a folder I use for archives.<br>At first I thought that I found a lot of notes that weren’t part of the current database. Because of this a lot of work went into preparing them and comparing them to the database content, to understand if they were, indeed, lost content. Turns out they weren’t and much of this work was in vain.  Not completely because, what was learned in this stage, was used after in other places. So, silver linings.<br>I imagine that the best beginning will be the file conversions. The seminal moment has to arrive when, in this second effort, we decide to let go of the files that we found, and focus only on converting the database’s content. Where, in the end, everything could be found.  </p>
<h3><span id="update">UPDATE</span></h3><p>This has much changed since I wrote it. It is now significantly shorter. Mainly because I understood that much of what they were doing, or trying to do, was either wrong or a dead end.<br>See the larger update at the bottom of this post.</p>
<br>
<br>

<hr>
<h3><span id="1-md_converterpy">1 - md_converter.py</span></h3><p>This file dumps the database, does some alterations to it, adds metadata fields, and writes the note content beneath.  </p>
<ol>
<li>Connects to the database:</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">     conn = connect(host=<span class="string">&quot;localhost&quot;</span>, user=<span class="string">&quot;mic&quot;</span>, password=<span class="string">&quot;xxxx&quot;</span>, database=<span class="string">&quot;notes&quot;</span>)</span><br><span class="line">     cur = conn.cursor()</span><br><span class="line">     query = <span class="string">&quot;SELECT * FROM notes&quot;</span></span><br><span class="line">     cur.execute(</span><br><span class="line">         query,</span><br><span class="line">     )</span><br><span class="line">     records = cur.fetchall()</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Gets the title value from the first row of returned values, puts a dash instead of empty spaces in it, deletes the slashes, and from these changes creates a new title, ended in ‘.md’:</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> records:</span><br><span class="line">    title = <span class="built_in">str</span>(row[<span class="number">1</span>])</span><br><span class="line">    change_tit = title.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;_&quot;</span>)</span><br><span class="line">    change_tit1 = change_tit.replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    filename = change_tit1 + <span class="string">&quot;.md&quot;</span></span><br><span class="line">    logger.info(filename)</span><br><span class="line">    writepath = <span class="string">&quot;/srv/http/notes/pages/markdown/&quot;</span> + filename</span><br><span class="line">    logger.info(writepath)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>Now it’s created the front-matter fields. They are:<ul>
<li>ID,</li>
<li>Title,</li>
<li>Time,</li>
<li>Tags.</li>
</ul>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(writepath, <span class="string">&quot;w+&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    file.write(<span class="string">&quot;---\n&quot;</span>)</span><br><span class="line">    file.write(<span class="string">&quot;id: &quot;</span>)</span><br><span class="line">    file.write(<span class="built_in">str</span>(row[<span class="number">0</span>]))</span><br><span class="line">    file.write(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    file.write(<span class="string">&quot;title: &quot;</span>)</span><br><span class="line">    file.write(<span class="built_in">str</span>(row[<span class="number">1</span>]))</span><br><span class="line">    file.write(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    file.write(<span class="string">&quot;time: &quot;</span>)</span><br><span class="line">    file.write(<span class="built_in">str</span>(row[<span class="number">7</span>]))</span><br><span class="line">    file.write(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    file.write(<span class="string">&quot;tags: &quot;</span>)</span><br><span class="line">    file.write(<span class="built_in">str</span>(row[<span class="number">2</span>]))</span><br><span class="line">    file.write(<span class="string">&quot;, &quot;</span>)</span><br><span class="line">    file.write(<span class="built_in">str</span>(row[<span class="number">3</span>]))</span><br><span class="line">    file.write(<span class="string">&quot;, &quot;</span>)</span><br><span class="line">    file.write(<span class="built_in">str</span>(row[<span class="number">4</span>]))</span><br><span class="line">    file.write(<span class="string">&quot;\n---\n&quot;</span>)</span><br><span class="line">    file.write(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    file.write(<span class="string">&quot;~~~python\n&quot;</span>)</span><br><span class="line">    file.write(<span class="built_in">str</span>(row[<span class="number">5</span>]))</span><br><span class="line">    file.write(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    file.write(<span class="string">&quot;~~~&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>The full text:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;Although some of the notes were already converted to markdown,</span></span><br><span class="line"><span class="string">   there is more content in the app database that can be used.&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"><span class="keyword">from</span> mysql.connector <span class="keyword">import</span> connect, Error</span><br><span class="line"></span><br><span class="line">fmt = <span class="string">&quot;&#123;time&#125; - &#123;name&#125; - &#123;level&#125; - &#123;message&#125;&quot;</span></span><br><span class="line">logger.add(<span class="string">&quot;info.log&quot;</span>, level=<span class="string">&quot;INFO&quot;</span>, <span class="built_in">format</span>=fmt, backtrace=<span class="literal">True</span>, diagnose=<span class="literal">True</span>)</span><br><span class="line">logger.add(<span class="string">&quot;error.log&quot;</span>, level=<span class="string">&quot;ERROR&quot;</span>, <span class="built_in">format</span>=fmt, backtrace=<span class="literal">True</span>, diagnose=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@logger.catch  </span><span class="comment"># Decorator for loguru. All errors will go into a log. Has to be on all functions.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">app_converter</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;We&#x27;ll dump the db and then iterate through it,</span></span><br><span class="line"><span class="string">    turning every entry in a md file.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        conn = connect(host=<span class="string">&quot;localhost&quot;</span>, user=<span class="string">&quot;mic&quot;</span>, password=<span class="string">&quot;xxxx&quot;</span>, database=<span class="string">&quot;notes&quot;</span>)</span><br><span class="line">        cur = conn.cursor()</span><br><span class="line">        query = <span class="string">&quot;SELECT * FROM notes&quot;</span></span><br><span class="line">        cur.execute(</span><br><span class="line">            query,</span><br><span class="line">        )</span><br><span class="line">        records = cur.fetchall()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> records:</span><br><span class="line">            title = <span class="built_in">str</span>(row[<span class="number">1</span>])</span><br><span class="line">            change_tit = title.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;_&quot;</span>)</span><br><span class="line">            change_tit1 = change_tit.replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">            filename = change_tit1 + <span class="string">&quot;.md&quot;</span></span><br><span class="line">            logger.info(filename)</span><br><span class="line">            writepath = <span class="string">&quot;/srv/http/notes/pages/markdown/&quot;</span> + filename</span><br><span class="line">            logger.info(writepath)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(writepath, <span class="string">&quot;w+&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">                file.write(<span class="string">&quot;---\n&quot;</span>)</span><br><span class="line">                file.write(<span class="string">&quot;id: &quot;</span>)</span><br><span class="line">                file.write(<span class="built_in">str</span>(row[<span class="number">0</span>]))</span><br><span class="line">                file.write(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">                file.write(<span class="string">&quot;title: &quot;</span>)</span><br><span class="line">                file.write(<span class="built_in">str</span>(row[<span class="number">1</span>]))</span><br><span class="line">                file.write(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">                file.write(<span class="string">&quot;time: &quot;</span>)</span><br><span class="line">                file.write(<span class="built_in">str</span>(row[<span class="number">7</span>]))</span><br><span class="line">                file.write(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">                file.write(<span class="string">&quot;tags: &quot;</span>)</span><br><span class="line">                file.write(<span class="built_in">str</span>(row[<span class="number">2</span>]))</span><br><span class="line">                file.write(<span class="string">&quot;, &quot;</span>)</span><br><span class="line">                file.write(<span class="built_in">str</span>(row[<span class="number">3</span>]))</span><br><span class="line">                file.write(<span class="string">&quot;, &quot;</span>)</span><br><span class="line">                file.write(<span class="built_in">str</span>(row[<span class="number">4</span>]))</span><br><span class="line">                file.write(<span class="string">&quot;\n---\n&quot;</span>)</span><br><span class="line">                file.write(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">                file.write(<span class="string">&quot;~~~python\n&quot;</span>)</span><br><span class="line">                file.write(<span class="built_in">str</span>(row[<span class="number">5</span>]))</span><br><span class="line">                file.write(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">                file.write(<span class="string">&quot;~~~&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Error <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Error while connecting to db&quot;</span>, e)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">if</span> conn:</span><br><span class="line">            conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app_converter()</span><br></pre></td></tr></table></figure>
<br>
<br>

<hr>
<h3><span id="2-html_converterpy">2 - html_converter.py</span></h3><p>The module converts the markdown files just created to html ones. Because it’s easier, I used <a target="_blank" rel="noopener" href="https://pandoc.org/">Pandoc</a> instead of relying in Python tools.</p>
<ol>
<li>If a filename is in the markdown folder, and is a markdown file, add its full path to a list.</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">folder = <span class="string">&quot;/srv/http/notes/pages/markdown/&quot;</span></span><br><span class="line">paths = []</span><br><span class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(folder):</span><br><span class="line">    <span class="keyword">if</span> filename.endswith(<span class="string">&quot;.md&quot;</span>):</span><br><span class="line">        paths.append(os.path.join(folder, filename))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>For each of these full paths we collected, get just the filename part, take out the three last characters from it, add to them ‘.html’, and use them in Pandoc as objective files for the markdown files.  </li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> path <span class="keyword">in</span> paths:</span><br><span class="line">    filename = os.path.basename(path)</span><br><span class="line">    html_url = filename[:-<span class="number">3</span>] + <span class="string">&quot;.html&quot;</span></span><br><span class="line">    logger.info(html_url)</span><br><span class="line">    cmd = <span class="string">&quot;pandoc --highlight-style=zenburn -s &quot;</span> + filename + <span class="string">&quot; -o&quot;</span> + html_url</span><br><span class="line">    logger.info(cmd)</span><br><span class="line">    subprocess.run(cmd, cwd=folder, shell=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>Finally, pass all html files to their own folder.  </li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(folder):</span><br><span class="line">    <span class="keyword">if</span> filename.endswith(<span class="string">&quot;.html&quot;</span>):</span><br><span class="line">        cmd = <span class="string">&quot;mv &quot;</span> + folder + <span class="string">&quot;/&quot;</span> + filename + <span class="string">&quot; /srv/http/notes/pages/html/&quot;</span></span><br><span class="line">        subprocess.run(cmd, shell=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>Full text:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;Module that will convert all md files into html, using pandoc&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"></span><br><span class="line">fmt = <span class="string">&quot;&#123;time&#125; - &#123;name&#125; - &#123;level&#125; - &#123;message&#125;&quot;</span></span><br><span class="line">logger.add(<span class="string">&quot;info.log&quot;</span>, level=<span class="string">&quot;INFO&quot;</span>, <span class="built_in">format</span>=fmt, backtrace=<span class="literal">True</span>, diagnose=<span class="literal">True</span>)</span><br><span class="line">logger.add(<span class="string">&quot;error.log&quot;</span>, level=<span class="string">&quot;ERROR&quot;</span>, <span class="built_in">format</span>=fmt, backtrace=<span class="literal">True</span>, diagnose=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@logger.catch  </span><span class="comment"># Decorator for loguru. All errors will go into a log. Has to be on all functions.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;I&#x27;ll be using pandoc as shell command as it is easier than programming it&quot;&quot;&quot;</span></span><br><span class="line">    folder = <span class="string">&quot;/srv/http/notes/pages/markdown/&quot;</span></span><br><span class="line">    paths = []</span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(folder):</span><br><span class="line">        <span class="keyword">if</span> filename.endswith(<span class="string">&quot;.md&quot;</span>):</span><br><span class="line">            paths.append(os.path.join(folder, filename))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> path <span class="keyword">in</span> paths:</span><br><span class="line">        filename = os.path.basename(path)</span><br><span class="line">        html_url = filename[:-<span class="number">3</span>] + <span class="string">&quot;.html&quot;</span></span><br><span class="line">        logger.info(html_url)</span><br><span class="line">        cmd = <span class="string">&quot;pandoc --highlight-style=zenburn -s &quot;</span> + filename + <span class="string">&quot; -o&quot;</span> + html_url</span><br><span class="line">        logger.info(cmd)</span><br><span class="line">        subprocess.run(cmd, cwd=folder, shell=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(folder):</span><br><span class="line">        <span class="keyword">if</span> filename.endswith(<span class="string">&quot;.html&quot;</span>):</span><br><span class="line">            cmd = <span class="string">&quot;mv &quot;</span> + folder + <span class="string">&quot;/&quot;</span> + filename + <span class="string">&quot; /srv/http/notes/pages/html/&quot;</span></span><br><span class="line">            subprocess.run(cmd, shell=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    convert()</span><br></pre></td></tr></table></figure>
<br>
<br>

<hr>
<h3><span id="3-id_url_listpy">3 - id_url_list.py</span></h3><p>This module creates a list with the id and URL of each note. This will serve to insert the URLs in the database.<br>The code is heavily commented, so I won’t say another word and publish the full version right now.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;Module to get a list with the id of the notes and their urls&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">import</span> markdown</span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line">fmt = <span class="string">&quot;&#123;time&#125; - &#123;name&#125; - &#123;level&#125; - &#123;message&#125;&quot;</span></span><br><span class="line">logger.add(<span class="string">&quot;info.log&quot;</span>, level=<span class="string">&quot;INFO&quot;</span>, <span class="built_in">format</span>=fmt, backtrace=<span class="literal">True</span>, diagnose=<span class="literal">True</span>)</span><br><span class="line">logger.add(<span class="string">&quot;error.log&quot;</span>, level=<span class="string">&quot;ERROR&quot;</span>, <span class="built_in">format</span>=fmt, backtrace=<span class="literal">True</span>, diagnose=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@logger.catch</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">id_url_list</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Create a file with the id and url of each note.</span></span><br><span class="line"><span class="string">    This will be fed to the database.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    md_page = <span class="string">&quot;/srv/http/notes/pages/markdown/&quot;</span>  <span class="comment"># This is needed to extract metadata values from the notes.</span></span><br><span class="line">    db_html_page = (</span><br><span class="line">        <span class="string">&quot;http://localhost/notes/pages/html/&quot;</span>  <span class="comment"># Format changes as this is how Nginx will look for the pages in the site.</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    notes = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(md_page):  <span class="comment"># For file in this folder:</span></span><br><span class="line">        notes.append(md_page + filename)  <span class="comment"># Creating the path for the markdown files</span></span><br><span class="line">    logger.info(notes)</span><br><span class="line"></span><br><span class="line">    id_list = []  <span class="comment"># The appending list must be outside of the loop. Took me forever to get this one.</span></span><br><span class="line">    title_list = []</span><br><span class="line">    <span class="keyword">for</span> note <span class="keyword">in</span> notes:</span><br><span class="line">        <span class="keyword">if</span> note[-<span class="number">3</span>:] == <span class="string">&quot;.md&quot;</span>:  <span class="comment"># There were python files in the folder, it was needed to specify only &#x27;md&#x27;.</span></span><br><span class="line">            data = Path(note).read_text(</span><br><span class="line">                encoding=<span class="string">&quot;utf-8&quot;</span></span><br><span class="line">            )  <span class="comment"># Formulation from the libpath library. I think it enables reaching info tied to a path.</span></span><br><span class="line">            md = markdown.Markdown(extensions=[<span class="string">&quot;meta&quot;</span>])  <span class="comment"># Defines the meta.information extension.</span></span><br><span class="line">            md.convert(data)</span><br><span class="line">            str_id = <span class="built_in">list</span>(md.Meta.items())[<span class="number">0</span>][</span><br><span class="line">                <span class="number">1</span></span><br><span class="line">            ]  <span class="comment"># Extract id value from metadata, by its position in the result dictionary.</span></span><br><span class="line">            id_list.extend(str_id)  <span class="comment"># The extend() method adds all the elements of an iterable to the end of a list.</span></span><br><span class="line">            str_title = <span class="built_in">list</span>(md.Meta.items())[<span class="number">1</span>][<span class="number">1</span>]  <span class="comment"># Extract title metadata value.</span></span><br><span class="line">            title_list.extend(str_title)</span><br><span class="line"></span><br><span class="line">    titles = []</span><br><span class="line">    <span class="keyword">for</span> titsy <span class="keyword">in</span> title_list:</span><br><span class="line">        tits = titsy.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;_&quot;</span>)  <span class="comment"># Many titles were phrases, it was needed to connect them.</span></span><br><span class="line">        <span class="comment"># tit = tits.lower()  # Pass them all to lowercase.</span></span><br><span class="line">        title = db_html_page + tits + <span class="string">&quot;.html&quot;</span>  <span class="comment"># Add the html file identifier.</span></span><br><span class="line">        titles.append(title)</span><br><span class="line"></span><br><span class="line">    id_title_dict = &#123;id_list[i]: titles[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(id_list))&#125;  <span class="comment"># Converts two lists into a dictionary.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Let&#x27;s create a items list, so we can send two values when we are writing the csv.</span></span><br><span class="line">    <span class="comment"># https://www.delftstack.com/howto/python/python-dictionary-index/</span></span><br><span class="line">    itms = <span class="built_in">list</span>(id_title_dict.items())</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Here will be passing the new dictionary into a csv file that can be understood by the database.</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;id_links.csv&quot;</span>, <span class="string">&quot;w&quot;</span>, newline=<span class="string">&quot;&quot;</span>) <span class="keyword">as</span> write_file:</span><br><span class="line">        writer = csv.writer(write_file, delimiter=<span class="string">&quot;|&quot;</span>)</span><br><span class="line">        writer.writerow([<span class="string">&quot;ntid&quot;</span>, <span class="string">&quot;link&quot;</span>])</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> itms:</span><br><span class="line">            writer.writerow(&#123;item&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    id_url_list()</span><br></pre></td></tr></table></figure>
<br>
<br>

<hr>
<h3><span id="4-csv_cleanuppy">4 - csv_cleanup.py</span></h3><p>The csv produced by the Python library was far from OK. A case of garbage in, garbage out. Some cleaning was in order.<br>This file is mainly a series of text manipulations, with the objective of making the csv look more with a real csv.<br>As was the case with the last one, this file is also very commented, so I’ll post the complete version right now:  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;The csv produced by the csv library is defective. To solve that</span></span><br><span class="line"><span class="string">    we&#x27;re going to clean it up after the fact. We&#x27;ll turn the id</span></span><br><span class="line"><span class="string">    and urls in two lists, and used them to build the csv manually.&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"></span><br><span class="line">fmt = <span class="string">&quot;&#123;time&#125; - &#123;name&#125; - &#123;level&#125; - &#123;message&#125;&quot;</span></span><br><span class="line">logger.add(<span class="string">&quot;info.log&quot;</span>, level=<span class="string">&quot;INFO&quot;</span>, <span class="built_in">format</span>=fmt, backtrace=<span class="literal">True</span>, diagnose=<span class="literal">True</span>)</span><br><span class="line">logger.add(<span class="string">&quot;error.log&quot;</span>, level=<span class="string">&quot;ERROR&quot;</span>, <span class="built_in">format</span>=fmt, backtrace=<span class="literal">True</span>, diagnose=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@logger.catch</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">csv_cleanup</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Several list and string manipulation commands will be used</span></span><br><span class="line"><span class="string">    until we achieve desired results.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;id_links.csv&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        outpt = f.read()</span><br><span class="line"></span><br><span class="line">    chng_chars0 = []  <span class="comment"># This kind of processes imply always a sequence of intermediate steps that have no</span></span><br><span class="line">    chng_chars1 = []  <span class="comment"># personality themselves, but are necessary for completing the task, Out of sheer</span></span><br><span class="line">    chng_chars2 = []  <span class="comment"># despair, I numerated the changes. I could&#x27;ve been able to use the same name, but it</span></span><br><span class="line">    chng_chars3 = []  <span class="comment"># wouldn&#x27;t have been as helpfull when debugging.</span></span><br><span class="line">    chng_chars3_id = []</span><br><span class="line">    chng_chars4_id = []</span><br><span class="line">    chng_chars4 = []</span><br><span class="line">    link_list = []</span><br><span class="line">    split_list = outpt.split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> split_list:  <span class="comment"># The entries had superfluous &quot;(&#x27;&#x27;)&quot; characters. We eliminate them.</span></span><br><span class="line">        chng_chars0.append(i[<span class="number">2</span>:-<span class="number">2</span>])</span><br><span class="line">    logger.info(chng_chars0)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> chng_chars0:  <span class="comment"># There was also excessive &#x27;&quot;&#x27; characters. That was erased too.</span></span><br><span class="line">        chng_chars1.append(i.replace(<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    logger.info(chng_chars1)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> chng_chars1:</span><br><span class="line">        chng_chars2.append(i.split(<span class="string">&quot;,&quot;</span>))  <span class="comment"># As the document was a string and didn&#x27;t had the concept of first</span></span><br><span class="line">    logger.info(chng_chars2)  <span class="comment"># and second bits of information; it was needed to divide the entries,</span></span><br><span class="line">    chng_chars2 = chng_chars2[<span class="number">1</span>:-<span class="number">1</span>]  <span class="comment"># with a comma as delimiter. Creates small lists of two elements.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(chng_chars2)):  <span class="comment"># Separated the first element of the lists into a id list, and the</span></span><br><span class="line">        chng_chars3.append(chng_chars2[i][<span class="number">1</span>])  <span class="comment"># second to a link list.</span></span><br><span class="line">        chng_chars3_id.append(chng_chars2[i][<span class="number">0</span>])</span><br><span class="line">    logger.info(chng_chars3)</span><br><span class="line">    logger.info(chng_chars3_id)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> chng_chars3:  <span class="comment"># There was, still, too much punctuation. Erased extraneous &quot;&#x27;&quot;.</span></span><br><span class="line">        chng_chars4.append(i.replace(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    logger.info(chng_chars4)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> chng_chars3_id:  <span class="comment"># There were, still, some left.</span></span><br><span class="line">        chng_chars4_id.append(i.replace(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    logger.info(chng_chars4_id)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> chng_chars4:  <span class="comment"># Did away with superfluous leading white space.</span></span><br><span class="line">        link_list.append(i.lstrip())</span><br><span class="line">    logger.info(link_list)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;link_lst&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:  <span class="comment"># Wrote a list with urls for all html pages.</span></span><br><span class="line">        f.write(<span class="built_in">str</span>(link_list))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;id_lst&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> <span class="built_in">id</span>:  <span class="comment"># Wrote a list of database ids to go with urls.</span></span><br><span class="line">        <span class="built_in">id</span>.write(<span class="built_in">str</span>(chng_chars4_id))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    csv_cleanup()</span><br></pre></td></tr></table></figure>
<br>
<br>

<hr>
<h3><span id="5-build_csvpy">5 - build_csv.py</span></h3><p>This module starts from the two files produced by ‘id_url_list.py’, and inserted them into a csv file.<br>This file, as others in this project, is very commented, so no comments from me are necessary.  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;Module That will send the info to the database and build the csv file as an alternative&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"><span class="keyword">from</span> mysql.connector <span class="keyword">import</span> connect, Error</span><br><span class="line"></span><br><span class="line">fmt = <span class="string">&quot;&#123;time&#125; - &#123;name&#125; - &#123;level&#125; - &#123;message&#125;&quot;</span></span><br><span class="line">logger.add(<span class="string">&quot;info.log&quot;</span>, level=<span class="string">&quot;INFO&quot;</span>, <span class="built_in">format</span>=fmt, backtrace=<span class="literal">True</span>, diagnose=<span class="literal">True</span>)</span><br><span class="line">logger.add(<span class="string">&quot;error.log&quot;</span>, level=<span class="string">&quot;ERROR&quot;</span>, <span class="built_in">format</span>=fmt, backtrace=<span class="literal">True</span>, diagnose=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@logger.catch</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">csv_build</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;We&#x27;ll start with the two files and write them to</span></span><br><span class="line"><span class="string">    a csv file manually.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(</span><br><span class="line">        <span class="string">&quot;id_lst&quot;</span>, <span class="string">&quot;r&quot;</span></span><br><span class="line">    ) <span class="keyword">as</span> idlst:  <span class="comment"># We open the file produced by the last module and turn its content into a object that we</span></span><br><span class="line">        id_src = idlst.read()  <span class="comment"># can work with. Opening the id list.</span></span><br><span class="line"></span><br><span class="line">    id_lt = id_src.split(</span><br><span class="line">        <span class="string">&quot;,&quot;</span></span><br><span class="line">    )  <span class="comment"># The read() function returns a string. To be able to have a concept of discrete elements,</span></span><br><span class="line">    csv_build.id_lt = id_lt[</span><br><span class="line">        <span class="number">1</span>:-<span class="number">1</span></span><br><span class="line">    ]  <span class="comment"># needed to run it to a list by spliting the string by a delimiter. The comma in this case.</span></span><br><span class="line">    <span class="built_in">print</span>(csv_build.id_lt[<span class="number">0</span>])  <span class="comment"># Elements came with superfluous &#x27;)&#x27; characters in the beginning and end.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;link_lst&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> lnklst:  <span class="comment"># Opening the link list.</span></span><br><span class="line">        lnk_src = lnklst.read()</span><br><span class="line"></span><br><span class="line">    lnk_lt = lnk_src.split()  <span class="comment"># Splitting the strings, for the same reasons explained above.</span></span><br><span class="line">    lnk_l = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> lnk_lt:</span><br><span class="line">        lnk_l.append(i[:-<span class="number">1</span>])  <span class="comment"># Erasing the last character in each element. I forget why.</span></span><br><span class="line">    csv_build.lnk_lt = lnk_l[</span><br><span class="line">        <span class="number">1</span>:-<span class="number">1</span></span><br><span class="line">    ]  <span class="comment"># Erased &quot;[]&quot; characters from list, as they were being considered as part of the first and last</span></span><br><span class="line">    <span class="built_in">print</span>(csv_build.lnk_lt[<span class="number">0</span>])  <span class="comment"># link elements.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;final.csv&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:  <span class="comment"># Creating the csv to be used to upload to the database.</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">id</span>, lnk <span class="keyword">in</span> <span class="built_in">zip</span>(</span><br><span class="line">            id_lt, lnk_lt</span><br><span class="line">        ):  <span class="comment"># Zip function permits to iterate between two functions, without one being first or second, but</span></span><br><span class="line">            f.write(<span class="built_in">id</span> + <span class="string">&quot;|&quot;</span> + lnk)  <span class="comment"># on equal footing. Useful when we needed to pair lists elements with each other.</span></span><br><span class="line">            f.write(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    csv_build()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@logger.catch</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">db_send</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Send the results to the db with update commands.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        conn = connect(host=<span class="string">&quot;localhost&quot;</span>, user=<span class="string">&quot;mic&quot;</span>, password=<span class="string">&quot;xxxx&quot;</span>, database=<span class="string">&quot;notes&quot;</span>)</span><br><span class="line">        cur = conn.cursor()</span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">id</span>, lnk <span class="keyword">in</span> <span class="built_in">zip</span>(csv_build.id_lt, csv_build.lnk_lt):</span><br><span class="line">            query = <span class="string">&quot;UPDATE notes SET url = &quot;</span> + lnk + <span class="string">&quot; WHERE ntid = &quot;</span> + <span class="built_in">id</span></span><br><span class="line">            logger.info(query)</span><br><span class="line">            cur.execute(query)</span><br><span class="line">        conn.commit()</span><br><span class="line">    <span class="keyword">except</span> Error <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Error while connecting to db&quot;</span>, e)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">if</span> conn:</span><br><span class="line">            conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    db_send()</span><br></pre></td></tr></table></figure>
<br>
<br>

<hr>
<h3><span id="6-chg_wordcloudpy">6 - chg_wordcloud.py</span></h3><p>This module is completely filled with preparatory work to insert the html links of the notes in the svg image.<br>This haas proved to be more complicated than expected. Every time I think I’m near, there appears another preparatory work that must be done, and I’m again mired in a swamp of preliminary work.<br>I’m starting to feel that I’m probably loosing focus and letting myself get mired in all this preparative steps. That there’s a simple and clearer way of doing things. I just have to find it.  </p>
<ol>
<li>The first function I just called ‘prep-work’, and it contains various small tasks that, in itself, don’t amount to much, but prepare the way for other things.  </li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@logger.catch</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">prep_work</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;We create a path containing object, turned wordcloud file into a list of lines,</span></span><br><span class="line"><span class="string">    created a file with the final lines that will house the a tag, enumerated the list</span></span><br><span class="line"><span class="string">    wordcloud. All prep-work necessary, we hope, to make the changes.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;path_lst.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> path:</span><br><span class="line">        path = path.read()</span><br><span class="line">    path = [path]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> path:</span><br><span class="line">        path = i.split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;wordcloud2.svg&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> wordcloud:</span><br><span class="line">        wordcloud = wordcloud.read()</span><br><span class="line">    wordcloud = [wordcloud]</span><br><span class="line">    <span class="comment"># print(type(wordcloud))</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> wordcloud:</span><br><span class="line">        wordcloud = i.split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    subs = <span class="string">&quot;transform&quot;</span></span><br><span class="line"></span><br><span class="line">    res = [i <span class="keyword">for</span> i <span class="keyword">in</span> wordcloud <span class="keyword">if</span> subs <span class="keyword">in</span> i]</span><br><span class="line"></span><br><span class="line">    complete_lines = []</span><br><span class="line">    <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(res, path):</span><br><span class="line">        complete_lines.append(x + y)</span><br><span class="line">    prep_work.complete_lines = complete_lines[:-<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;complete_lines.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> complete_lines:</span><br><span class="line">            f.write(line)</span><br><span class="line">            f.write(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    wordcloud = <span class="built_in">enumerate</span>(wordcloud)</span><br><span class="line">    prep_work.wordcloud = <span class="built_in">list</span>(wordcloud)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    prep_work()</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Here we connect the URLs to their corresponding tags.</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@logger.catch</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">numbered_tags</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;In order to put the URLS to their corresponding text tag, we created a list</span></span><br><span class="line"><span class="string">    that has line numbers and tag names. This is to be used when we insert the</span></span><br><span class="line"><span class="string">    the lines from &#x27;complete_lines&#x27;, as a marker of where to put them in the</span></span><br><span class="line"><span class="string">    document.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    text_tags = []  <span class="comment"># Here I was trying to extract a substring from between two other substrings.</span></span><br><span class="line">    left_side = <span class="string">&#x27;alphabetic&quot;&gt;&#x27;</span>  <span class="comment"># I half failed as, if I did get what I wanted, I also collected a lot of shit</span></span><br><span class="line">    right_side = <span class="string">&quot;&lt;/text&gt;&quot;</span>  <span class="comment"># that I don&#x27;t know where it came from.</span></span><br><span class="line">    <span class="keyword">for</span> (</span><br><span class="line">        num,</span><br><span class="line">        line,</span><br><span class="line">    ) <span class="keyword">in</span> prep_work.wordcloud:  <span class="comment"># This is not the best praxis, but I&#x27;ll leave this here, for now, as it got me</span></span><br><span class="line">        idx_left_side = line.find(left_side) + <span class="built_in">len</span>(</span><br><span class="line">            left_side</span><br><span class="line">        )  <span class="comment"># nearer to where I want to get, and it&#x27;s late and I&#x27;m not nearly finished.</span></span><br><span class="line">        idx_right_side = line.find(right_side)</span><br><span class="line">        text_tags.append((num, line[idx_left_side:idx_right_side]))</span><br><span class="line">    <span class="keyword">for</span> num, line <span class="keyword">in</span> text_tags:  <span class="comment"># From here onwards things start to make sense again.</span></span><br><span class="line">        <span class="keyword">if</span> line == <span class="string">&quot; &quot;</span>:</span><br><span class="line">            <span class="keyword">del</span> line</span><br><span class="line">    text_tags = text_tags[<span class="number">8</span>:-<span class="number">4</span>]</span><br><span class="line">    numbered_tags.text_tags = <span class="built_in">list</span>(<span class="built_in">filter</span>(<span class="keyword">lambda</span> t: <span class="string">&quot;&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> t, text_tags))  <span class="comment"># https://tinyurl.com/yeqxxgrf</span></span><br><span class="line">    numbered_tags.text_tags = numbered_tags.text_tags[::<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    numbered_tags()</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>Here the objective was to create a list with the tags and the lines of text, with original text and our own, already done. This proved too difficult in Python, so I used various shell tools, that are documented in the body of the function.</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@logger.catch</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lines_tags</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Function to create a list with tags and complete lines&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># num_tag = numbered_tags.text_tags</span></span><br><span class="line">    <span class="comment"># Because I had a lot of difficulty doing this kind of operations in Python, I turned for Bash,</span></span><br><span class="line">    <span class="comment"># for help, specifcally Sed.</span></span><br><span class="line">    <span class="comment"># I added separated tag values to the complete lines file with this expression:</span></span><br><span class="line">    <span class="comment"># sed -e &quot;s/tag= \(.*\)\&quot;&gt;/\1/&quot; complete_lines.txt</span></span><br><span class="line">    <span class="comment"># More here - https://tinyurl.com/yfrayu96</span></span><br><span class="line">    <span class="comment"># But Sed put the tag immediately after the url. So I&#x27;ll use this function to create a list of</span></span><br><span class="line">    <span class="comment"># tuples.</span></span><br><span class="line">    <span class="comment"># UPDATE</span></span><br><span class="line">    <span class="comment"># I couldn&#x27;t acomplish even that.</span></span><br><span class="line">    <span class="comment"># So, the day was saved with this Sed expression:</span></span><br><span class="line">    <span class="comment"># sed &#x27;s/php?/&amp;, /&#x27; lines_tags.txt</span></span><br><span class="line">    <span class="comment"># It adds a comma and a space after &#x27;php?&#x27;</span></span><br><span class="line">    <span class="comment"># It was also needed to add &#x27; characters around the entries.</span></span><br><span class="line">    <span class="comment"># To add one in the beginning of the line, I used this expression:</span></span><br><span class="line">    <span class="comment"># sed -ne &quot;s/.*/\&#x27;&amp;/p&quot; lines_tags.txt</span></span><br><span class="line">    <span class="comment"># To add another at the end of the line, I used:</span></span><br><span class="line">    <span class="comment"># It was needed to put one in the end of the first element:</span></span><br><span class="line">    <span class="comment"># sed &quot;s/php?/&amp;&#x27;/&quot; lines_tags.txt</span></span><br><span class="line">    <span class="comment"># and at the start of the second.</span></span><br><span class="line">    <span class="comment"># sed &quot;s/, /&amp;&#x27;/&quot; lines_tags.txt</span></span><br><span class="line">    <span class="comment"># I used Awk to add a tag field to the file. The script is this:</span></span><br><span class="line">    <span class="comment"># With all this we have a file that is more evolved than what I had before.</span></span><br><span class="line">    <span class="comment"># I&#x27;m going to import it, and try to finish in Python.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;lines_tags1.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        lt = f.read()</span><br><span class="line">    lt = [lt]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> lt:</span><br><span class="line">        lt = i.split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    <span class="keyword">del</span> lt[<span class="number">1</span>]</span><br><span class="line">    new_lt = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> lt:</span><br><span class="line">        new_lt.append(i.split(<span class="string">&quot;, &quot;</span>))</span><br><span class="line">    <span class="keyword">del</span> new_lt[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> new_lt:</span><br><span class="line">        i[<span class="number">0</span>] = i[<span class="number">0</span>][:-<span class="number">3</span>] + i[<span class="number">1</span>] + i[<span class="number">0</span>][-<span class="number">2</span>]</span><br><span class="line">    lines_tags.new_lt = new_lt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    lines_tags()</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>The svg file already has an order that the tags must obey, when being inserted into the body of the code. I analyzed the svg code with <a target="_blank" rel="noopener" href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/">BeautifulSoup</a>, to connect correctly our tags with the image’s.  </li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@logger.catch</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">beautsoup</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;We&#x27;ll use BeautifullSoup, a HTML interpreter to read the svg file and get the</span></span><br><span class="line"><span class="string">    value of each tag in the text, so as to connect it to right tag in the a tag.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;wordcloud.svg&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        soup = BeautifulSoup(fp, <span class="string">&quot;xml&quot;</span>, from_encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    beautsoup.texts = soup.find_all(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    beautsoup.new = []</span><br><span class="line">    <span class="keyword">for</span> text <span class="keyword">in</span> beautsoup.texts:</span><br><span class="line">        beautsoup.new.append(text.get_text())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> beautsoup.new:</span><br><span class="line">        i = <span class="string">&quot;&#x27;&quot;</span> + i + <span class="string">&quot;&#x27;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;beautsoup.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="built_in">str</span>(beautsoup.new))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    beautsoup()</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>Sorting the URLS in the same order as the tags.  </li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@logger.catch</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">taglines_sorting</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;We&#x27;ll sort the urls in the same order as the tags. We&#x27;ll look for</span></span><br><span class="line"><span class="string">    occurrences of the tags in the text in the urls. When found,</span></span><br><span class="line"><span class="string">    it&#x27;ll create a order that will be, we hope, easy to do.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    lt = lines_tags.new_lt</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;beautsoup2.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        lines = f.readline()</span><br><span class="line">    lines.split(<span class="string">&quot;\n&quot;</span>)  <span class="comment"># Objects coming from files are very large strings, who are good for nothing. These steps were an</span></span><br><span class="line">    lines = lines.split()  <span class="comment"># effort at making it mnore elastic.</span></span><br><span class="line">    lines1 = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> lines:</span><br><span class="line">        lines1.append(i.replace(<span class="string">&quot;,&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line"></span><br><span class="line">    it_line = []</span><br><span class="line">    flat_lt = []</span><br><span class="line">    <span class="keyword">for</span> i, line <span class="keyword">in</span> <span class="built_in">zip</span>(<span class="built_in">range</span>(<span class="built_in">len</span>(lines1)), lines1):  <span class="comment"># I use zip when I want to simultaneously open two iterables.</span></span><br><span class="line">        it_line.append((<span class="built_in">str</span>(i), line))</span><br><span class="line">    <span class="keyword">for</span> element <span class="keyword">in</span> it_line:  <span class="comment"># The list had another list inside. We simplified it.</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">type</span>(element) <span class="keyword">is</span> <span class="built_in">list</span>:</span><br><span class="line">            <span class="keyword">for</span> item <span class="keyword">in</span> element:</span><br><span class="line">                flat_lt.append(item)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flat_lt.append(element)</span><br><span class="line">    flat_lt[<span class="number">0</span>] = (<span class="string">&quot;0&quot;</span>, <span class="string">&quot;python&quot;</span>)  <span class="comment"># These two entries had supirous charcters inside. We clean them</span></span><br><span class="line">    flat_lt[-<span class="number">1</span>] = (<span class="string">&quot;283&quot;</span>, <span class="string">&quot;array&quot;</span>)  <span class="comment"># with these commands</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(flat_lt)):</span><br><span class="line">        line = flat_lt[i][<span class="number">1</span>]</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            [x <span class="keyword">for</span> x <span class="keyword">in</span> lt <span class="keyword">if</span> line <span class="keyword">in</span> x]</span><br><span class="line">        )  <span class="comment"># List comprehension to ascertain if substring is contained inside a string.</span></span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    taglines_sorting()</span><br></pre></td></tr></table></figure>

<p>The full text:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;Module To insert in the Wordcloud file, the urls of the notes&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">fmt = <span class="string">&quot;&#123;time&#125; - &#123;name&#125; - &#123;level&#125; - &#123;message&#125;&quot;</span></span><br><span class="line">logger.add(<span class="string">&quot;info.log&quot;</span>, level=<span class="string">&quot;INFO&quot;</span>, <span class="built_in">format</span>=fmt, backtrace=<span class="literal">True</span>, diagnose=<span class="literal">True</span>)</span><br><span class="line">logger.add(<span class="string">&quot;tag_order.log&quot;</span>, level=<span class="string">&quot;INFO&quot;</span>, <span class="built_in">format</span>=fmt, backtrace=<span class="literal">True</span>, diagnose=<span class="literal">True</span>)</span><br><span class="line">logger.add(<span class="string">&quot;error.log&quot;</span>, level=<span class="string">&quot;ERROR&quot;</span>, <span class="built_in">format</span>=fmt, backtrace=<span class="literal">True</span>, diagnose=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@logger.catch</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">prep_work</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;We create a path containing object, turned wordcloud file into a list of lines,</span></span><br><span class="line"><span class="string">    created a file with the final lines that will house the a tag, enumerated the list</span></span><br><span class="line"><span class="string">    wordcloud. All prep-work necessary, we hope, to make the changes.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;path_lst.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> path:</span><br><span class="line">        path = path.read()</span><br><span class="line">    path = [path]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> path:</span><br><span class="line">        path = i.split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;wordcloud2.svg&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> wordcloud:</span><br><span class="line">        wordcloud = wordcloud.read()</span><br><span class="line">    wordcloud = [wordcloud]</span><br><span class="line">    <span class="comment"># print(type(wordcloud))</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> wordcloud:</span><br><span class="line">        wordcloud = i.split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    subs = <span class="string">&quot;transform&quot;</span></span><br><span class="line"></span><br><span class="line">    res = [i <span class="keyword">for</span> i <span class="keyword">in</span> wordcloud <span class="keyword">if</span> subs <span class="keyword">in</span> i]</span><br><span class="line"></span><br><span class="line">    complete_lines = []</span><br><span class="line">    <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(res, path):</span><br><span class="line">        complete_lines.append(x + y)</span><br><span class="line">    prep_work.complete_lines = complete_lines[:-<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;complete_lines.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> complete_lines:</span><br><span class="line">            f.write(line)</span><br><span class="line">            f.write(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    wordcloud = <span class="built_in">enumerate</span>(wordcloud)</span><br><span class="line">    prep_work.wordcloud = <span class="built_in">list</span>(wordcloud)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    prep_work()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@logger.catch</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">numbered_tags</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;In order to put the URLS to their corresponding text tag, we created a list</span></span><br><span class="line"><span class="string">    that has line numbers and tag names. This is to be used when we insert the</span></span><br><span class="line"><span class="string">    the lines from &#x27;complete_lines&#x27;, as a marker of where to put them in the</span></span><br><span class="line"><span class="string">    document.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    text_tags = []  <span class="comment"># Here I was trying to extract a substring from between two other substrings.</span></span><br><span class="line">    left_side = <span class="string">&#x27;alphabetic&quot;&gt;&#x27;</span>  <span class="comment"># I half failed as, if I did get what I wanted, I also collected a lot of shit</span></span><br><span class="line">    right_side = <span class="string">&quot;&lt;/text&gt;&quot;</span>  <span class="comment"># that I don&#x27;t know where it came from.</span></span><br><span class="line">    <span class="keyword">for</span> (</span><br><span class="line">        num,</span><br><span class="line">        line,</span><br><span class="line">    ) <span class="keyword">in</span> prep_work.wordcloud:  <span class="comment"># This is not the best praxis, but I&#x27;ll leave this here, for now, as it got me</span></span><br><span class="line">        idx_left_side = line.find(left_side) + <span class="built_in">len</span>(</span><br><span class="line">            left_side</span><br><span class="line">        )  <span class="comment"># nearer to where I want to get, and it&#x27;s late and I&#x27;m not nearly finished.</span></span><br><span class="line">        idx_right_side = line.find(right_side)</span><br><span class="line">        text_tags.append((num, line[idx_left_side:idx_right_side]))</span><br><span class="line">    <span class="keyword">for</span> num, line <span class="keyword">in</span> text_tags:  <span class="comment"># From here onwards things start to make sense again.</span></span><br><span class="line">        <span class="keyword">if</span> line == <span class="string">&quot; &quot;</span>:</span><br><span class="line">            <span class="keyword">del</span> line</span><br><span class="line">    text_tags = text_tags[<span class="number">8</span>:-<span class="number">4</span>]</span><br><span class="line">    numbered_tags.text_tags = <span class="built_in">list</span>(<span class="built_in">filter</span>(<span class="keyword">lambda</span> t: <span class="string">&quot;&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> t, text_tags))  <span class="comment"># https://tinyurl.com/yeqxxgrf</span></span><br><span class="line">    numbered_tags.text_tags = numbered_tags.text_tags[::<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    numbered_tags()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@logger.catch</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lines_tags</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Function to create a list with tags and complete lines&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># num_tag = numbered_tags.text_tags</span></span><br><span class="line">    <span class="comment"># Because I had a lot of difficulty doing this kind of operations in Python, I turned for Bash,</span></span><br><span class="line">    <span class="comment"># for help, specifcally Sed.</span></span><br><span class="line">    <span class="comment"># I added separated tag values to the complete lines file with this expression:</span></span><br><span class="line">    <span class="comment"># sed -e &quot;s/tag= \(.*\)\&quot;&gt;/\1/&quot; complete_lines.txt</span></span><br><span class="line">    <span class="comment"># More here - https://tinyurl.com/yfrayu96</span></span><br><span class="line">    <span class="comment"># But Sed put the tag immediately after the url. So I&#x27;ll use this function to create a list of</span></span><br><span class="line">    <span class="comment"># tuples.</span></span><br><span class="line">    <span class="comment"># UPDATE</span></span><br><span class="line">    <span class="comment"># I couldn&#x27;t acomplish even that.</span></span><br><span class="line">    <span class="comment"># So, the day was saved with this Sed expression:</span></span><br><span class="line">    <span class="comment"># sed &#x27;s/php?/&amp;, /&#x27; lines_tags.txt</span></span><br><span class="line">    <span class="comment"># It adds a comma and a space after &#x27;php?&#x27;</span></span><br><span class="line">    <span class="comment"># It was also needed to add &#x27; characters around the entries.</span></span><br><span class="line">    <span class="comment"># To add one in the beginning of the line, I used this expression:</span></span><br><span class="line">    <span class="comment"># sed -ne &quot;s/.*/\&#x27;&amp;/p&quot; lines_tags.txt</span></span><br><span class="line">    <span class="comment"># To add another at the end of the line, I used:</span></span><br><span class="line">    <span class="comment"># It was needed to put one in the end of the first element:</span></span><br><span class="line">    <span class="comment"># sed &quot;s/php?/&amp;&#x27;/&quot; lines_tags.txt</span></span><br><span class="line">    <span class="comment"># and at the start of the second.</span></span><br><span class="line">    <span class="comment"># sed &quot;s/, /&amp;&#x27;/&quot; lines_tags.txt</span></span><br><span class="line">    <span class="comment"># I used Awk to add a tag field to the file. The script is this:</span></span><br><span class="line">    <span class="comment"># With all this we have a file that is more evolved than what I had before.</span></span><br><span class="line">    <span class="comment"># I&#x27;m going to import it, and try to finish in Python.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;lines_tags1.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        lt = f.read()</span><br><span class="line">    lt = [lt]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> lt:</span><br><span class="line">        lt = i.split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    <span class="keyword">del</span> lt[<span class="number">1</span>]</span><br><span class="line">    new_lt = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> lt:</span><br><span class="line">        new_lt.append(i.split(<span class="string">&quot;, &quot;</span>))</span><br><span class="line">    <span class="keyword">del</span> new_lt[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> new_lt:</span><br><span class="line">        i[<span class="number">0</span>] = i[<span class="number">0</span>][:-<span class="number">3</span>] + i[<span class="number">1</span>] + i[<span class="number">0</span>][-<span class="number">2</span>]</span><br><span class="line">    lines_tags.new_lt = new_lt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    lines_tags()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@logger.catch</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">beautsoup</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;We&#x27;ll use BeautifullSoup, a HTML interpreter to read the svg file and get the</span></span><br><span class="line"><span class="string">    value of each tag in the text, so as to connect it to right tag in the a tag.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;wordcloud.svg&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        soup = BeautifulSoup(fp, <span class="string">&quot;xml&quot;</span>, from_encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    beautsoup.texts = soup.find_all(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    beautsoup.new = []</span><br><span class="line">    <span class="keyword">for</span> text <span class="keyword">in</span> beautsoup.texts:</span><br><span class="line">        beautsoup.new.append(text.get_text())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> beautsoup.new:</span><br><span class="line">        i = <span class="string">&quot;&#x27;&quot;</span> + i + <span class="string">&quot;&#x27;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;beautsoup.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="built_in">str</span>(beautsoup.new))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    beautsoup()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@logger.catch</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">taglines_sorting</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;We&#x27;ll sort the urls in the same order as the tags. We&#x27;ll look for</span></span><br><span class="line"><span class="string">    occurrences of the tags in the text in the urls. When found,</span></span><br><span class="line"><span class="string">    it&#x27;ll create a order that will be, we hope, easy to do.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    lt = lines_tags.new_lt</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;beautsoup2.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        lines = f.readline()</span><br><span class="line">    lines.split(<span class="string">&quot;\n&quot;</span>)  <span class="comment"># Objects coming from files are very large strings, who are good for nothing. These steps were an</span></span><br><span class="line">    lines = lines.split()  <span class="comment"># effort at making it mnore elastic.</span></span><br><span class="line">    lines1 = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> lines:</span><br><span class="line">        lines1.append(i.replace(<span class="string">&quot;,&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line"></span><br><span class="line">    it_line = []</span><br><span class="line">    flat_lt = []</span><br><span class="line">    <span class="keyword">for</span> i, line <span class="keyword">in</span> <span class="built_in">zip</span>(<span class="built_in">range</span>(<span class="built_in">len</span>(lines1)), lines1):  <span class="comment"># I use zip when I want to simultaneously open two iterables.</span></span><br><span class="line">        it_line.append((<span class="built_in">str</span>(i), line))</span><br><span class="line">    <span class="keyword">for</span> element <span class="keyword">in</span> it_line:  <span class="comment"># The list had another list inside. We simplified it.</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">type</span>(element) <span class="keyword">is</span> <span class="built_in">list</span>:</span><br><span class="line">            <span class="keyword">for</span> item <span class="keyword">in</span> element:</span><br><span class="line">                flat_lt.append(item)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flat_lt.append(element)</span><br><span class="line">    flat_lt[<span class="number">0</span>] = (<span class="string">&quot;0&quot;</span>, <span class="string">&quot;python&quot;</span>)  <span class="comment"># These two entries had supirous charcters inside. We clean them</span></span><br><span class="line">    flat_lt[-<span class="number">1</span>] = (<span class="string">&quot;283&quot;</span>, <span class="string">&quot;array&quot;</span>)  <span class="comment"># with these commands</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(flat_lt)):</span><br><span class="line">        line = flat_lt[i][<span class="number">1</span>]</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            [x <span class="keyword">for</span> x <span class="keyword">in</span> lt <span class="keyword">if</span> line <span class="keyword">in</span> x]</span><br><span class="line">        )  <span class="comment"># List comprehension to ascertain if substring is contained inside a string.</span></span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    taglines_sorting()</span><br></pre></td></tr></table></figure>

<h1><span id="update">UPDATE</span></h1><p>Well, on the bright side, I finished what I set out to do, to set up the svg image with new links. On not so brighter note, I did almost all important work by hand or through the shell, and, in the end, this was nothing that I really wanted. Not really.<br>I had had, I thought, a simple task ahead of me: To insert into a file, lines that should be 3 lines apart between themselves.<br>I couldn’t do it. I stumbled on the problem of needing two iterators running at the same time, one giving the lines to insert, another for the line numbers, and, one, couldn’t solve it, and, two, couldn’t think of something else.<br>In the end I went with a solution who got me what I wanted, but it also produced a mountain of spurious data.<br>What I’ve done was this:  </p>
<ol>
<li>Created a list with the numbers I was going to need. Already skipping 3 numbers by iteration, already starting at the line number that the command I wanted to replace, first appears.  </li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sel = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(word), <span class="number">3</span>)]</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Set a loop through the list of the lines to insert, created a variable to:<ul>
<li>Define the number of the line that was going to be erased. In order for the new one to be inserted,</li>
<li>define, in the same manner, the line number for the insertion operation,</li>
<li>be the base for a variable that will write to file.<br>  The reason for the <em><strong>variable + 1</strong></em>, came from a need I had when building this solution, to see the evolution of the loops and how much were they covering the text-tags list. It’s there just so I can get my head around the problem.  </li>
</ul>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">    pos = <span class="built_in">int</span>(sel[<span class="number">0</span>])</span><br><span class="line">    word.pop(pos)</span><br><span class="line">    word.insert(pos, url)</span><br><span class="line">    posi = pos + <span class="number">1</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>And, finally, sent everything to a file. Because I couldn’t figure out how to keep in the same variable, the lines I didn’t want to change, and the ones I did.<br>Everything I tried, ended with a variable with only the changed lines or with the unchanged list. At least in this way, I could access what I wanted during the running of the loop. In the end it was just a case of separating the wheat from the chaff, which was simple, but didn’t alleviate the feeling that I was, both, an idiot and a cheat.<br>Here’s the full code:</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;Module to append the completed lines to the text tags.&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> pprint <span class="keyword">import</span> pprint</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"></span><br><span class="line">fmt = <span class="string">&quot;&#123;time&#125; - &#123;name&#125; - &#123;level&#125; - &#123;message&#125;&quot;</span></span><br><span class="line">logger.add(<span class="string">&quot;info.log&quot;</span>, level=<span class="string">&quot;INFO&quot;</span>, <span class="built_in">format</span>=fmt, backtrace=<span class="literal">True</span>, diagnose=<span class="literal">True</span>)</span><br><span class="line">logger.add(<span class="string">&quot;error.log&quot;</span>, level=<span class="string">&quot;ERROR&quot;</span>, <span class="built_in">format</span>=fmt, backtrace=<span class="literal">True</span>, diagnose=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@logger.catch</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">url_appending</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Although this produces far too much output that I need, the fact is</span></span><br><span class="line"><span class="string">    it does produce what I&#x27;m looking for. As this is a one-time project,</span></span><br><span class="line"><span class="string">    I&#x27;m just going to cut what I need, put it in a file, and do any</span></span><br><span class="line"><span class="string">    cleaning I need with sed, awk and things of that ilk.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;wordcloud1.svg&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        word = f.readlines()</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;line_complete.svg&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        urls = f.readlines()</span><br><span class="line"></span><br><span class="line">    sel = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(word), <span class="number">3</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> sel:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">        pos = <span class="built_in">int</span>(sel[<span class="number">0</span>])</span><br><span class="line">        word.pop(pos)</span><br><span class="line">        word.insert(pos, url)</span><br><span class="line">        posi = pos + <span class="number">1</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;final.svg&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(<span class="built_in">str</span>(word[:posi]))</span><br><span class="line">            f.write(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">            pprint(word[:posi])</span><br><span class="line">        sel.pop(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    url_appending()</span><br></pre></td></tr></table></figure>

<p>After this, I still had much to do, using Sed and Awk to clean the files to the shape it was needed. In that respect, this effort was not in vain. I come out of this with a much clearer understanding of both these tools. But that was not my original intention.<br>It was happily fortuitous.<br>My intention was learn more about python with a project heavy on file manipulation. And it seemed I couldn’t understand it, so I used other means.<br>On top of all this, there’s the fact that, in the end, I decided I didn’t want the word cloud anymore. I am to build something from just the links that, if not so polished, it won’t so trite.<br>This project left me with an unfinished feeling. I know that are python solutions for the problem I was facing, and I imagine they won’t metaphysically complex, I just have to dig deeper.</p>
</div></div><div class="footer"><div class="footer-copyright">Theme By <a target="_blank" rel="noopener" href="https://github.com/shinux/hexo-theme-adoubi">Adoubi</a> , Powered By Hexo.</div></div></body></html>