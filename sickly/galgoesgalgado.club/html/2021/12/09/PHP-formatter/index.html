<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>PHP-formatter</title><link rel="stylesheet" href="/css/normalize.css"><link rel="stylesheet" href="/css/heti.min.css"><link rel="stylesheet" href="/css/hexo-theme-adoubi.css"><link rel="icon" href="/images/favicon.ico"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="" type="application/atom+xml">
</head><body><div class="header"><a class="github-link" target="_blank" rel="noopener" href="https://notabug.org/micaldas"><img class="github-image" src="/images/Aquicon-Github-small.png"></a><a class="email-link" href="mailto:mclds@protonmail.com"><img class="email-image" src="/images/email-small.png"></a><a class="subscribe-link" href="/atom.xml"><img class="subscribe-image" src="/images/subscribe-small.png"></a></div><div class="content"><div class="post-item"></div><h2 class="post-title-wrapper"><p class="post-title">PHP-formatter</p></h2><div class="post-date"><time datetime="2021-12-09T20:53:33.000Z">2021-12-09</time></div><div class="post-content"><p>I just finished a project where I learned a lot of new things and I<br> need to put everything on paper, so I don’t forget.<br> I was fiddling around with a website I’m making in PHP and noticed that,<br> in regards to formatting, I had a bit of a problem.<br> There are automatic formatters for almost all languages under the sun, but<br> what doesn’t exist, and it’s not surprising, is a formatter for<br> code that is embedded in another language’s file.<br> Let me be clearer, I came to PHP because I wanted to make database calls and<br> automate some aspects of my toy sites. That meant, and means, that my code is<br> not heavy-duty PHP. It’s more a lot of HTML interspersed with the occasional<br> PHP.<br> The HTML written in a PHP file, although not understood by the latter, it’s<br> still decoded successfully by the browser, which allows for running its code in<br> HTML or PHP files. The same doesn’t happen with PHP. If written in a HTML file,<br> its code will be treated as comment and won’t get run.<br> What this means is that you can program front/back end in PHP, but not in<br> HTML, which ends up with people like yours truly, writing everything in files<br> with PHP extensions.<br> Another thing that is important to mention is that HTML is ugly. It’s painful<br> to look at, and I, and I imagine a lot more people, have this deep desire to<br> make it look less awful.<br> That’s where the formatters come in. Although generally a little bossy and opinionated,<br> they’re nevertheless, an almost-good solution to the problem.<br> It never gets pretty, but it is much better than the starting point.<br> I found that I had no way to format the HTML I had inside PHP files, and that<br> felt bad.<br> But, I thought, if I altered the extension of the file just for a little bit, I<br> could use the formatter, change it back again, and the changes would already<br> been done! Easy. Except that, after a cursory reflexion, it really<br> isn’t. It would be really cumbersome going through that process every time I wanted to format.<br> It was then that I decided to automate it.<br> Even if it took considerably longer than doing it manually.<br> As it did.<br> I also took this as an opportunity to try different cli app builders that I had<br> on the backburner as something to try one day. Well, the day had come.<br> I wanted to create a class that would encompass all the steps of the process,<br> which are:  </p>
<ol>
<li>Make a list of all PHP files in the current folder,  </li>
<li>Change their extensions from ‘.php’ to ‘.html’,  </li>
<li>Open the folders, write a small message and close it back again,  </li>
<li>Get the HTML files, already formatted, and change them back to PHP.  </li>
</ol>
<p> The reasoning behind step 3 is this; I have my formatters running automatically<br> in Vim, every time that a file is saved. So, it only takes opening and closing<br> them to guarantee that the formatting is done. The message is just as an<br> assurance that is really working and that an effort has been made.<br> For the cli app build, I first tried <a target="_blank" rel="noopener" href="https://typer.tiangolo.com/">Typer</a>, which<br> if really cool and complete, I couldn’t make it work in a Class environment.<br> The commands wouldn’t work if they shared argument space with things like ‘self’.<br> So I tried <a target="_blank" rel="noopener" href="https://google.github.io/python-fire">Fire</a>, and it was love at<br> first site. Not only it supported classes, it was immensely more intuitive, easy<br> and user-friendly. I got the idea that you can’t go do all the things that you<br> can with Typer, but I’m a simple man with simple needs. Fire will suffice.<br> I started by creating a folder called ‘html’, to put the<br> files. If it’s mid/large project, it can get messy real quick.  </p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dir</span> = os.getcwd()</span><br><span class="line">        path = <span class="built_in">dir</span> + <span class="string">&quot;/&quot;</span> + <span class="string">&quot;html&quot;</span></span><br><span class="line">        os.mkdir(path)</span><br></pre></td></tr></table></figure>

<p> Then I made a list of all the PHP extension files in the current folder, I’m<br> assuming this will be opened where the content will be.  </p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">self.php_file_list = []</span><br><span class="line">       files = os.listdir(os.curdir)</span><br><span class="line">       <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">           <span class="keyword">if</span> <span class="string">&quot;.php&quot;</span> <span class="keyword">in</span> file:</span><br><span class="line">               self.php_file_list.append(file)</span><br><span class="line">       <span class="keyword">return</span> self.php_file_list</span><br></pre></td></tr></table></figure>

<p> Now, in the file creation step, I had to account for two possible sources of<br> data: one, the user through command line commands, two, our pre-made list that<br> we just seen. If no file list is supplied by the user, the PHP file list is<br> used.<br> I tried to maintain the paths relative, although I loathe working with them, so<br> I wouldn’t have to change them each time there’s another project. If this will work,<br> only time will tell.  </p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">flist = self.available_php_files()</span><br><span class="line">        <span class="keyword">if</span> files:</span><br><span class="line">            ficheiros = files</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ficheiros = flist</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> file <span class="keyword">in</span> ficheiros:</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;.php&quot;</span> <span class="keyword">in</span> file:</span><br><span class="line">                    src = <span class="string">&quot;./&quot;</span> + file</span><br><span class="line">                    self.dst = <span class="string">&quot;html/&quot;</span></span><br><span class="line">                    shutil.copy(src, self.dst)</span><br><span class="line">                    self.new_dir = os.listdir(self.dst)</span><br><span class="line">                    <span class="keyword">for</span> file <span class="keyword">in</span> self.new_dir:</span><br><span class="line">                        infilename = os.path.join(self.dst, file)</span><br><span class="line">                        newfile = infilename.replace(<span class="string">&quot;.php&quot;</span>, <span class="string">&quot;.html&quot;</span>)</span><br><span class="line">                        os.rename(infilename, newfile)</span><br></pre></td></tr></table></figure>

<p> The next step was an interesting one. I had a loop I wanted to run through for<br> every file path in the HTML folder. It would open it, write a<br> message, and close it again.<br> But when I tried it, it was iterating through all entries, writing a message for each entry in each file,<br> when what I needed was one message per file.<br> So to make it go just one round, I set a counter to zero, defined a while loop<br> that ran only if the counter was below one. It worked pretty well.<br> I should also mention that os.listdir(some_folder) will give you a list of all<br> the files in said folder. This might not be too exciting, but it’s the type of<br> things that I’ll forget.  </p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">os.chdir(self.dst)</span><br><span class="line">        self.curdir = os.getcwd()</span><br><span class="line">        sourcelst = []</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(self.curdir):</span><br><span class="line">            source = self.curdir + <span class="string">&quot;/&quot;</span> + file</span><br><span class="line">            sourcelst.append(source)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">runs</span>(<span class="params">file</span>):</span></span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(file, <span class="string">&quot;a&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(<span class="string">&quot;&lt;!--This file was automatically formatted.--&gt;&quot;</span>)</span><br><span class="line"></span><br><span class="line">        run_once = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> run_once &lt; <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">for</span> file <span class="keyword">in</span> sourcelst:</span><br><span class="line">                runs(file)</span><br><span class="line">                run_once += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        self.signed_files = []</span><br><span class="line">        <span class="keyword">for</span> source <span class="keyword">in</span> sourcelst:</span><br><span class="line">            self.signed_files.append(source)</span><br></pre></td></tr></table></figure>

<p> Now we get the HTML files, copy them to their original folder and there we<br> change the extension back to ‘.php’.  </p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> self.signed_files:</span><br><span class="line">           src = file</span><br><span class="line">           new = os.path.dirname(__file__)</span><br><span class="line">           shutil.copy(src, new)</span><br><span class="line"></span><br><span class="line">       <span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(new):</span><br><span class="line">           <span class="keyword">if</span> <span class="string">&quot;.html&quot;</span> <span class="keyword">in</span> file:</span><br><span class="line">               infilename = os.path.join(new, file)</span><br><span class="line">               newfile = infilename.replace(<span class="string">&quot;.html&quot;</span>, <span class="string">&quot;.php&quot;</span>)</span><br><span class="line">               os.rename(infilename, newfile)</span><br></pre></td></tr></table></figure>

<p> And lastly a main function that sums up all the steps.  </p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">self.create_html_folder()</span><br><span class="line">self.available_php_files()</span><br><span class="line">self.create_files()</span><br><span class="line">self.open_write_comment()</span><br><span class="line">self.new_php()</span><br><span class="line">self.new_php</span><br></pre></td></tr></table></figure>

<p> With the awesomeness of Fire, most of my user interaction woes were resolved.<br> All it takes is putting a small snippet of code in the bottom of the class,<br> like this:  </p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    fire.Fire(PhpFormatter)</span><br></pre></td></tr></table></figure>

<p> and all the methods, objects and properties are accessible through this kind of<br> syntax:  </p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;filename&gt; &lt;method_name&gt; --&lt;properties&gt; &lt;arguments&gt;</span><br></pre></td></tr></table></figure>

<p> All in all, a fun project.</p>
</div></div><div class="footer"><div class="footer-copyright">Theme By <a target="_blank" rel="noopener" href="https://github.com/shinux/hexo-theme-adoubi">Adoubi</a> , Powered By Hexo.</div></div></body></html>