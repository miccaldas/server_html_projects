<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>Uploading to a Hugo Blog</title><link rel="stylesheet" href="/css/normalize.css"><link rel="stylesheet" href="/css/heti.min.css"><link rel="stylesheet" href="/css/hexo-theme-adoubi.css"><link rel="icon" href="/images/favicon.ico"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="" type="application/atom+xml">
</head><body><div class="header"><a class="github-link" target="_blank" rel="noopener" href="https://notabug.org/micaldas"><img class="github-image" src="/images/Aquicon-Github-small.png"></a><a class="email-link" href="mailto:mclds@protonmail.com"><img class="email-image" src="/images/email-small.png"></a><a class="subscribe-link" href="/atom.xml"><img class="subscribe-image" src="/images/subscribe-small.png"></a></div><div class="content"><div class="post-item"></div><h2 class="post-title-wrapper"><p class="post-title">Uploading to a Hugo Blog</p></h2><div class="post-date"><time datetime="2021-01-28T20:23:01.000Z">2021-01-28</time></div><div class="post-content"><p>This blog has put me in front of some new challenges.<br>Well, not really challenges, minor nuisances, in the great big scheme of things … Trifles … puerile pursuits really.<br>So, <a target="_blank" rel="noopener" href="https://gohugo.io/">Hugo</a> the web platform that powers this blog, is web-server agnostic. Much due to the fact that it’s serving static files. So this entails that content production has, more or less, the following workflow: you write what you have to write, put the photos or images that you want in your post and all is right, proper and ready to go.<br>When done, you write <code>hugo</code>, just like that, and it will update all the files, creating a folder named  ‘public’, where all the new HTML is, ready to be used. What you do with it, it’s totally up to you.<br>Want to send it through Apache, Nginx? be my guest. Want to send it to Heroku? It just so happens we have an integration for it!<br>Since I only worked with personal blogs or sites, and because no one told me what the best-practices were, and if they did, I didn’t get it, I always worked in the server. I would download all the tools I needed for the site, and did all work from there. I’m a big of command line so, this helped a bit. Whenever<br>something must be done with a GUI tool, editing an image for example, I would work locally and upload it with <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Secure_file_transfer_program">sftp</a>. Which is a wonderful tool, by the way.<br>So I never had a mental image of the web framework as a separate entity from the<br>web-server. Also, and this must the real reason,, through sheer incompetence, generally I would have an horrible time trying to setup these frameworks.<br>I could never put the web-server working correctly. It could be that the ssl wouldn’t recognize all pages as part of the site, or the homepage was the only one to<br>be served, or a myriad other things, I felt, I had no knowledge or control.<br>So I thought, (brilliantly, I know), that if I downloaded the programs to the server folder, it would be already in a place where it should be, I pondered, and would make the whole process a lot simpler. I concluded.<br>For some fortuitous reason, probably better explained by the alignment of the stars, or the protection of a beneficent deity, I got one of these frameworks working.So mired in retrospective determinism was I that I assumed that my guess was right, that you should download, build and manage the framework from the web-site folder. Needless to say that all my folders were exposed on the internet, and open to attack, because, why shouldn’t they? If you’re going half-ass a project, aim for<br>the stars I say.<br>There’s no more eloquent statement of how perfunctory is the interest of other people in what I have to say, than the fact that I had this sad state of affairs<br>exposed for a year or more on the web, and no one seemed interested in taking advantage of this marvelous opportunity for mischief. So I never questioned this empirical truth for years,<br>until the fact that I wasn’t succeeding in installing <a target="_blank" rel="noopener" href="https://hexo.io/">hexo</a>, (through no fault of hexo’s, I<br>understood after), made me try to set up the development part in my computer. Just so I could follow the setup instructions to the letter.<br>This led me to awesome conclusion that web content and web serving are two different things, never again to be confused.<br>So, you have a ‘public folder’ with all your new shiny HTML, what do you need to do?<br>You need to, in the root folder of your blog project, write the following:  </p>
<pre><code> 
   sftp username@hostname
   cd /path/to/server/web-server/folder
   put -r public
   chown -R www-data:www-data public
   bye
</code></pre>
<p>The <code>chown</code> command is there because every time that there’s an upload, the files come with my user, and I need the files to be in the server’s user (www-data), so it can access the data.<br>There’s also the fact that ownership changing in sftp, requires userid and grpid, it won’t accept a name.<br>And if that’s the kind of information you can conjure up on your mind at command; you’re a better man that I.<br>This process was ripe for automation, I thought, so I started working.<br>For the sake of debugging and what interpreter to use, I partitioned the commands in two parts, one to upload the files, the other to change the file’s ownership. Finally I created a third to call the other two in sequence.<br>The first I called it <code>send_hugo.sh</code>:  </p>
<pre><code>  
 #!/usr/bin/env zsh

 rsync  -av  --delete -e  'ssh -i /home/mic/.ssh/id_rsa' /home/mic/dazed/public \
 root@45.76.37.62:/var/www/constantconstipation.club/html/ \
 > /home/mic/cronlogs/hugo.log 2>&
</code></pre>
<p>In truth I’m not replacing the files, what I am doing is syncing the development version with the production version. This way only what is changed is sent to the server.<br>Note that I sent all output to a ‘hugo.log’ file, so I can know what fresh hell have I dragged myself this time.<br>The second is called <code>permissions_hugo.sh</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> fabric <span class="keyword">import</span> Connection</span><br><span class="line"></span><br><span class="line">c = Connection(</span><br><span class="line">   host = <span class="string">&#x27;constantconstipation.club&#x27;</span>,</span><br><span class="line">   user = <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">   connect_kwargs=&#123;</span><br><span class="line">       <span class="string">&#x27;key_filename&#x27;</span>: <span class="string">&#x27;/home/mic/.ssh/id_rsa&#x27;</span></span><br><span class="line">   &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">c .run(<span class="string">&#x27;cd /var/www/constantconstipation.club/html/ &amp;&amp; chown -R \</span></span><br><span class="line"><span class="string">www-data:www-data public&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>This script uses a Python tool called <a target="_blank" rel="noopener" href="https://docs.fabfile.org/en/2.6/index.html">fabric</a>, that allows to send commands to the server from your local computer. It can also send files to the server, but it can’t pass folders recursively. That is another reason why I split the script in two parts. One is best run as the shell and the other as python. Off course I could have made it all in Python, by using <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/subprocess.html">subprocess</a> in the first part.<br>But laziness prevailed, and I stuck with what was easier.<br>Finally, I created an alias in .zshrc for the script that calls the other two in sequence, and now I can do the uploading and ownership setting just by writing <code>upld</code> in the shell.<br>You’re probably a worldlier person than I, and may not be very impressed by this setup, but me, having done so little with my life, and understood even less, think it’s pretty nifty.</p>
</div></div><div class="footer"><div class="footer-copyright">Theme By <a target="_blank" rel="noopener" href="https://github.com/shinux/hexo-theme-adoubi">Adoubi</a> , Powered By Hexo.</div></div></body></html>