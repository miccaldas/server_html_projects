<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>stats</title><link rel="stylesheet" href="/css/normalize.css"><link rel="stylesheet" href="/css/heti.min.css"><link rel="stylesheet" href="/css/hexo-theme-adoubi.css"><link rel="icon" href="/images/favicon.ico"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="" type="application/atom+xml">
</head><body><div class="header"><a class="github-link" target="_blank" rel="noopener" href="https://notabug.org/micaldas"><img class="github-image" src="/images/Aquicon-Github-small.png"></a><a class="email-link" href="mailto:mclds@protonmail.com"><img class="email-image" src="/images/email-small.png"></a><a class="subscribe-link" href="/atom.xml"><img class="subscribe-image" src="/images/subscribe-small.png"></a></div><div class="content"><div class="post-item"></div><h2 class="post-title-wrapper"><p class="post-title">stats</p></h2><div class="post-date"><time datetime="2021-09-29T15:17:46.000Z">2021-09-29</time></div><div class="post-content"><p>This conversation will be, yet again, about the notes app, and some minor<br>tweaks that I made. There was a lot of things I tried to implement in the<br>app that, although successful, were a bit too much information for little<br>value. As I didn’t want to loose all that I had did, as some have the<br>silly charm of things that are not serious, needed, but just superfluous<br>and mildly cool. Or at least that’s what I think.<br>I decided to aggregate all this spurious information in a small module<br>called ‘stats.py’. It is accessed through the main interface as its own<br>entry, so it won’t bother anyone who doesn’t want to be bothered.  </p>
<h3><span id="tag_list">tag_list</span></h3><p>The first one returns a list of tags ordered by the number of mentions it<br>has. I’ve done it thusly:<br>To present the tags by number of mentions, I used the MySQL expression:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">queries = [</span><br><span class="line">        <span class="string">&quot;SELECT k1, count(*) as links FROM notes GROUP BY k1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;SELECT k2, count(*) as links FROM notes GROUP BY k2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;SELECT k3, count(*) as links FROM notes GROUP BY k3&quot;</span>,</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>
<p>This returns a tuple with the tag and the number of links.<br>To sort the list of tuples by the link number values, I had to find a way to<br>sort the tuples by its second value.<br>I find the following expression that does just that but that, sadly, I don’t<br>understand at all.  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">records.sort(</span><br><span class="line">            key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>]</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>
<p>In order to clean the output of all the tuple and list symbols, I used a list<br>comprehension to flatten out the list of tuples to just a list.  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">records = [i <span class="keyword">for</span> t <span class="keyword">in</span> records <span class="keyword">for</span> i <span class="keyword">in</span> t]</span><br></pre></td></tr></table></figure>
<p>I now had a clean output but I wanted to give some colour to the presentation.<br>Specifically I wanted the tag name to be in a colour and the value in another.<br>The solution I found was to zip the list and iteratively connect it with<br>herself.<br>This was a very cool solution, that I’m not involved at all, except as avid<br>reader of Stack-Overflow.  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">it = <span class="built_in">iter</span>(records)</span><br><span class="line"><span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(it, it):</span><br><span class="line">    <span class="built_in">print</span>(color(<span class="string">&quot;  &quot;</span> + x, fore=<span class="string">&quot;#acac87&quot;</span>)), <span class="built_in">print</span>(color(<span class="string">&quot;  &quot;</span> + <span class="built_in">str</span>(y), fore=<span class="string">&quot;#f18892&quot;</span>))</span><br></pre></td></tr></table></figure>

<h3><span id="entries">entries</span></h3><p>This functions just returns the number of entries in the database, with this<br>expression:  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;SELECT COUNT(*) FROM notes&quot;</span></span><br></pre></td></tr></table></figure>
<p>And there is nothing more to say, really.  </p>
<h3><span id="tags">tags</span></h3><p>This one was surprisingly difficult.  I needed to make three queries to the<br>database, one for each keyword column, with this format:  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;SELECT COUNT(DISTINCT k1) FROM notes&quot;</span></span><br></pre></td></tr></table></figure>
<p>“Count” adds the k1 entries and “distinct” ensures that no repeated value is<br>taken in consideration. My idea was to bundle all the queries, as done before,<br>and sum the results between the elements of a list. I thought wrong.<br>For some reason, each value taken from k1, k2, k3, were presented as a organic<br>whole. The list had just one entry and the values had no individual existence.<br>So, no way to sum them. The not elegant but efficacious solution was to process<br>each column separately, insuring that its output was separated from the other<br>values. Something like this:  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = connect(host=<span class="string">&quot;localhost&quot;</span>, user=<span class="string">&quot;mic&quot;</span>, password=<span class="string">&quot;xxxx&quot;</span>, database=<span class="string">&quot;notes&quot;</span>)</span><br><span class="line">    cur = conn.cursor()</span><br><span class="line">    query = queryk1</span><br><span class="line">    cur.execute(</span><br><span class="line">        query,</span><br><span class="line">    )</span><br><span class="line">    recordk1 = cur.fetchone()</span><br><span class="line"></span><br><span class="line">    query = queryk2</span><br><span class="line">    cur.execute(</span><br><span class="line">        query,</span><br><span class="line">    )</span><br><span class="line">    recordk2 = cur.fetchone()</span><br><span class="line"></span><br><span class="line">    query = queryk3</span><br><span class="line">    cur.execute(</span><br><span class="line">        query,</span><br><span class="line">    )</span><br><span class="line">    recordk3 = cur.fetchone()</span><br></pre></td></tr></table></figure>
<p>This is atrocious I know, but I just couldn’t grok how to solve that problem.<br>Now I had three lists, each with a one-element tuple inside it, that I needed<br>to add up. Once again, I helped myself to some magical coding, and used a<br>solution that I don’t understand at all.  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">soma = <span class="built_in">tuple</span>(<span class="built_in">map</span>(<span class="built_in">sum</span>, <span class="built_in">zip</span>(recordk1, recordk2, recordk3)))</span><br></pre></td></tr></table></figure>

<p>Here’s the complete code:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;Module will aggregate disparate statistics about the app.&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"><span class="keyword">from</span> colr <span class="keyword">import</span> color</span><br><span class="line"><span class="keyword">from</span> mysql.connector <span class="keyword">import</span> connect, Error</span><br><span class="line"></span><br><span class="line">fmt = <span class="string">&quot;&#123;time&#125; - &#123;name&#125; - &#123;level&#125; - &#123;message&#125;&quot;</span></span><br><span class="line">logger.add(<span class="string">&quot;info.log&quot;</span>, level=<span class="string">&quot;INFO&quot;</span>, <span class="built_in">format</span>=fmt, backtrace=<span class="literal">True</span>, diagnose=<span class="literal">True</span>)</span><br><span class="line">logger.add(<span class="string">&quot;error.log&quot;</span>, level=<span class="string">&quot;ERROR&quot;</span>, <span class="built_in">format</span>=fmt, backtrace=<span class="literal">True</span>, diagnose=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@logger.catch</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tag_list</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;I&#x27;ll join the three lists and order them by number of connections.&quot;&quot;&quot;</span></span><br><span class="line">    queries = [</span><br><span class="line">        <span class="string">&quot;SELECT k1, count(*) as links FROM notes GROUP BY k1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;SELECT k2, count(*) as links FROM notes GROUP BY k2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;SELECT k3, count(*) as links FROM notes GROUP BY k3&quot;</span>,</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> q <span class="keyword">in</span> queries:</span><br><span class="line">            conn = connect(host=<span class="string">&quot;localhost&quot;</span>, user=<span class="string">&quot;mic&quot;</span>, password=<span class="string">&quot;xxxx&quot;</span>, database=<span class="string">&quot;notes&quot;</span>)</span><br><span class="line">            cur = conn.cursor()</span><br><span class="line">            query = q</span><br><span class="line">            logger.info(query)</span><br><span class="line">            cur.execute(</span><br><span class="line">                query,</span><br><span class="line">            )</span><br><span class="line">        records = cur.fetchall()</span><br><span class="line">        <span class="comment"># Records is a list and row is a tuple with the tag name and number of connections.</span></span><br><span class="line"></span><br><span class="line">        records.sort(</span><br><span class="line">            key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>]</span><br><span class="line">        )  <span class="comment"># This sorts the list by the value of the second element. https://tinyurl.com/yfn9alt7</span></span><br><span class="line">        records = [i <span class="keyword">for</span> t <span class="keyword">in</span> records <span class="keyword">for</span> i <span class="keyword">in</span> t]</span><br><span class="line">        it = <span class="built_in">iter</span>(records)  <span class="comment"># Solution to intercalate colorization, taken from here https://tinyurl.com/ygpwdrcl</span></span><br><span class="line">        <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(it, it):</span><br><span class="line">            <span class="built_in">print</span>(color(<span class="string">&quot;  &quot;</span> + x, fore=<span class="string">&quot;#acac87&quot;</span>)), <span class="built_in">print</span>(color(<span class="string">&quot;  &quot;</span> + <span class="built_in">str</span>(y), fore=<span class="string">&quot;#f18892&quot;</span>))</span><br><span class="line">    <span class="keyword">except</span> Error <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Error while connecting to db&quot;</span>, e)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">if</span> conn:</span><br><span class="line">            conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    tag_list()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@logger.catch</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">entries</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Returns the number of entries in the database&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        conn = connect(host=<span class="string">&quot;localhost&quot;</span>, user=<span class="string">&quot;mic&quot;</span>, password=<span class="string">&quot;xxxx&quot;</span>, database=<span class="string">&quot;notes&quot;</span>)</span><br><span class="line">        cur = conn.cursor()</span><br><span class="line">        query = <span class="string">&quot;SELECT COUNT(*) FROM notes&quot;</span></span><br><span class="line">        cur.execute(</span><br><span class="line">            query,</span><br><span class="line">        )</span><br><span class="line">        records = cur.fetchall()</span><br><span class="line">        records = [i <span class="keyword">for</span> t <span class="keyword">in</span> records <span class="keyword">for</span> i <span class="keyword">in</span> t]</span><br><span class="line">        records = <span class="built_in">str</span>(records)</span><br><span class="line">        records = records[<span class="number">1</span>:-<span class="number">1</span>]</span><br><span class="line">        tag_num = <span class="built_in">int</span>(records) * <span class="number">3</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(color(<span class="string">f&quot;  The number of database entries is <span class="subst">&#123;records&#125;</span>&quot;</span>, fore=<span class="string">&quot;#a5a590&quot;</span>))</span><br><span class="line">    <span class="keyword">except</span> Error <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Error while connecting to db&quot;</span>, e)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">if</span> conn:</span><br><span class="line">            conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    entries()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@logger.catch</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tags</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Counts all keywords without duplications&quot;&quot;&quot;</span></span><br><span class="line">    queryk1 = <span class="string">&quot;SELECT COUNT(DISTINCT k1) FROM notes&quot;</span></span><br><span class="line">    queryk2 = <span class="string">&quot;SELECT COUNT(DISTINCT k2) FROM notes&quot;</span></span><br><span class="line">    queryk3 = <span class="string">&quot;SELECT COUNT(DISTINCT k3) FROM notes&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        conn = connect(host=<span class="string">&quot;localhost&quot;</span>, user=<span class="string">&quot;mic&quot;</span>, password=<span class="string">&quot;xxxx&quot;</span>, database=<span class="string">&quot;notes&quot;</span>)</span><br><span class="line">        cur = conn.cursor()</span><br><span class="line">        query = queryk1</span><br><span class="line">        cur.execute(</span><br><span class="line">            query,</span><br><span class="line">        )</span><br><span class="line">        recordk1 = cur.fetchone()</span><br><span class="line"></span><br><span class="line">        query = queryk2</span><br><span class="line">        cur.execute(</span><br><span class="line">            query,</span><br><span class="line">        )</span><br><span class="line">        recordk2 = cur.fetchone()</span><br><span class="line"></span><br><span class="line">        query = queryk3</span><br><span class="line">        cur.execute(</span><br><span class="line">            query,</span><br><span class="line">        )</span><br><span class="line">        recordk3 = cur.fetchone()</span><br><span class="line"></span><br><span class="line">        soma = <span class="built_in">tuple</span>(<span class="built_in">map</span>(<span class="built_in">sum</span>, <span class="built_in">zip</span>(recordk1, recordk2, recordk3)))  <span class="comment"># Taken from here: https://tinyurl.com/y35we4g7</span></span><br><span class="line">        soma = <span class="built_in">str</span>(soma)</span><br><span class="line">        soma = soma[<span class="number">1</span>:-<span class="number">2</span>]</span><br><span class="line">        <span class="built_in">print</span>(color(<span class="string">f&quot;  The number of tags in the database is <span class="subst">&#123;soma&#125;</span>&quot;</span>, fore=<span class="string">&quot;a5a590&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Error <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Error while connecting to db&quot;</span>, e)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">if</span> conn:</span><br><span class="line">            conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    tags()</span><br></pre></td></tr></table></figure>
</div></div><div class="footer"><div class="footer-copyright">Theme By <a target="_blank" rel="noopener" href="https://github.com/shinux/hexo-theme-adoubi">Adoubi</a> , Powered By Hexo.</div></div></body></html>