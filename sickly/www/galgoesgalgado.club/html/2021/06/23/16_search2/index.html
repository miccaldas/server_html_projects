<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>More tales about search</title><link rel="stylesheet" href="/css/normalize.css"><link rel="stylesheet" href="/css/heti.min.css"><link rel="stylesheet" href="/css/hexo-theme-adoubi.css"><link rel="icon" href="/images/favicon.ico"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="" type="application/atom+xml">
</head><body><div class="header"><a class="github-link" target="_blank" rel="noopener" href="https://notabug.org/micaldas"><img class="github-image" src="/images/Aquicon-Github-small.png"></a><a class="email-link" href="mailto:mclds@protonmail.com"><img class="email-image" src="/images/email-small.png"></a><a class="subscribe-link" href="/atom.xml"><img class="subscribe-image" src="/images/subscribe-small.png"></a></div><div class="content"><div class="post-item"></div><h2 class="post-title-wrapper"><p class="post-title">More tales about search</p></h2><div class="post-date"><time datetime="2021-06-23T07:44:00.000Z">2021-06-23</time></div><div class="post-content"><p>There were developments regarding the blog’s search.<br>I wasn’t very happy with my first stab at implementing a search function.<br>If you recall, I used a database to collect metadata about the posts and then sourced it with PHP’s PDO.<br>The problem was that the example that I copied, presented the data in table. Something I didn’t like.<br>Add to that the fact that there was a considerable part of that code that I didn’t understand, and all that made me think I needed another solution.<br>I wanted to show the title of the posts, as a link, and a small description. Interestingly I found out that doing exactly what I wanted, is much simpler and had the added benefit of allowing me to grok a lot more about PDO’s functionalities.<br>I start by collecting the user’s search choice:  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$question</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;quest&#x27;</span>];</span><br></pre></td></tr></table></figure>
<p>defining the login information,</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="variable">$where</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">  <span class="variable">$user</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">  <span class="variable">$password</span> = <span class="string">&quot;xxxx&quot;</span>;</span><br><span class="line">  <span class="variable">$dbname</span> = <span class="string">&quot;dazed&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>defining the login object,</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$pdo</span> = <span class="keyword">new</span> PDO(<span class="string">&quot;mysql:host=<span class="subst">$where</span>;dbname=<span class="subst">$dbname</span>&quot;</span>, <span class="variable">$user</span>, <span class="variable">$password</span>);</span><br></pre></td></tr></table></figure>
<p>defining the query,</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT title, link, description FROM dazed WHERE \</span></span><br><span class="line"><span class="string">MATCH(title, author, description, tags, categories)\</span></span><br><span class="line"><span class="string">AGAINST (&#x27;<span class="subst">$question</span>&#x27; IN NATURAL LANGUAGE MODE)&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>connecting,</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$q</span> = <span class="variable">$pdo</span>-&gt;query(<span class="variable">$sql</span>);</span><br></pre></td></tr></table></figure>
<p>this defines how the information is gotten. Fetching associatively downloads the query plus their column name, as keys,</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$q</span>-&gt;setFetchMode(PDO::FETCH_ASSOC);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>  defining what to output in case of error,<br>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">catch</span>(PDOException <span class="variable">$e</span>) &#123;</span><br><span class="line">     <span class="keyword">echo</span> <span class="string">&quot;Error: &quot;</span> . <span class="variable">$e</span>-&gt;getMessage();</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><br>in other tags, we’ll define how the information will be outputted. This means that, row for row, we should get the data from the columns link and title<br>and print it as a link. The latter with ‘[]’ around the information.  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">while</span> (<span class="variable">$row</span> = <span class="variable">$q</span>-&gt;fetch()): <span class="meta">?&gt;</span></span><br><span class="line">&lt;a href=<span class="string">&quot;&lt;?php echo (<span class="subst">$row</span>[&#x27;link&#x27;]); ?&gt;&quot;</span>&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="string">&#x27;[&#x27;</span>; <span class="meta">?&gt;</span><span class="meta">&lt;?php</span> <span class="keyword">echo</span> (<span class="variable">$row</span>[<span class="string">&#x27;title&#x27;</span>]); <span class="meta">?&gt;</span><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="string">&#x27;]&#x27;</span>; <span class="meta">?&gt;</span>&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<p>finally get the description column value and close the ‘while’ loop.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;h6&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> (<span class="variable">$row</span>[<span class="string">&#x27;description&#x27;</span>]); <span class="meta">?&gt;</span>&lt;/h6&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">endwhile</span>; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>And this is the complete code:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;search_list&lt;/title&gt;</span><br><span class="line">&lt;link rel=<span class="string">&quot;preconnect&quot;</span> href=<span class="string">&quot;https://fonts.gstatic.com&quot;</span>&gt;</span><br><span class="line">&lt;link href=<span class="string">&quot;https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&amp;display=swap&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;https://corteousquestions.club/libraries/w3.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;link href=<span class="string">&quot;search_list.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">grid</span>-<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class"> &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">content</span>-<span class="title">wrap</span>&quot;&gt;</span></span><br><span class="line"><span class="class"> &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col_center</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">$<span class="title">question</span> = $<span class="title">_GET</span>[&#x27;<span class="title">quest</span>&#x27;];</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">try</span> </span>&#123;</span><br><span class="line">  <span class="variable">$where</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">  <span class="variable">$user</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">  <span class="variable">$password</span> = <span class="string">&quot;xxxx&quot;</span>;</span><br><span class="line">  <span class="variable">$dbname</span> = <span class="string">&quot;dazed&quot;</span>;</span><br><span class="line">  <span class="variable">$pdo</span> = <span class="keyword">new</span> PDO(<span class="string">&quot;mysql:host=<span class="subst">$where</span>;dbname=<span class="subst">$dbname</span>&quot;</span>, <span class="variable">$user</span>, <span class="variable">$password</span>);</span><br><span class="line">  <span class="variable">$sql</span> = <span class="string">&quot;SELECT title, link, description FROM dazed WHERE MATCH(title, author, description, tags, categories) AGAINST (&#x27;<span class="subst">$question</span>&#x27; IN NATURAL LANGUAGE MODE)&quot;</span>;</span><br><span class="line">  <span class="variable">$q</span> = <span class="variable">$pdo</span>-&gt;query(<span class="variable">$sql</span>);</span><br><span class="line">  <span class="variable">$q</span>-&gt;setFetchMode(PDO::FETCH_ASSOC);</span><br><span class="line">  &#125; <span class="keyword">catch</span>(PDOException <span class="variable">$e</span>) &#123;</span><br><span class="line">     <span class="keyword">echo</span> <span class="string">&quot;Error: &quot;</span> . <span class="variable">$e</span>-&gt;getMessage();</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">while</span> (<span class="variable">$row</span> = <span class="variable">$q</span>-&gt;fetch()): <span class="meta">?&gt;</span></span><br><span class="line">&lt;a href=<span class="string">&quot;&lt;?php echo (<span class="subst">$row</span>[&#x27;link&#x27;]); ?&gt;&quot;</span>&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="string">&#x27;[&#x27;</span>; <span class="meta">?&gt;</span><span class="meta">&lt;?php</span> <span class="keyword">echo</span> (<span class="variable">$row</span>[<span class="string">&#x27;title&#x27;</span>]); <span class="meta">?&gt;</span><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="string">&#x27;]&#x27;</span>; <span class="meta">?&gt;</span>&lt;/a&gt;</span><br><span class="line">&lt;h6&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> (<span class="variable">$row</span>[<span class="string">&#x27;description&#x27;</span>]); <span class="meta">?&gt;</span>&lt;/h6&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">endwhile</span>; <span class="meta">?&gt;</span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div w3-<span class="keyword">include</span>-html=<span class="string">&quot;https://corteousquestions.club/partials/footer_pages.html&quot;</span>&gt;</span><br><span class="line">&lt;script&gt;w3.includeHTML();&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</div></div><div class="footer"><div class="footer-copyright">Theme By <a target="_blank" rel="noopener" href="https://github.com/shinux/hexo-theme-adoubi">Adoubi</a> , Powered By Hexo.</div></div></body></html>